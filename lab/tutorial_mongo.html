
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>pyg.mongo &#8212; pyg 0.0.1 documentation</title>
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="pyg.base.cell" href="tutorial_cell.html" />
    <link rel="prev" title="pyg.base.dictable" href="tutorial_dictable.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<div class="section" id="pyg.mongo">
<h1>pyg.mongo<a class="headerlink" href="#pyg.mongo" title="Permalink to this headline">¶</a></h1>
<p>MongoDB has replaced our SQL databases as it is just too much fun to use. MongoDB does have its little quirks:</p>
<ul class="simple">
<li><p>The MongoDB ‘query document’ that replaces the SQL WHERE statements is very powerful but you need a PhD for even the simplest of queries.</p></li>
<li><p>too many objects we use (specifically, numpy and pandas objects) cannot be pushed directly easily into Mongo.</p></li>
<li><p>Mongo lacks the concept of a table with primary keys. Unstructured data is great but much of how we think of data is structured.</p></li>
</ul>
<p>pyg.mongo addresses all three issues:</p>
<ul class="simple">
<li><p><strong>q</strong> is a much easier way to generate Mongo queries. We are happy to acknowledge TinyDB <a class="reference external" href="https://tinydb.readthedocs.io/en/latest/usage.html#queries">https://tinydb.readthedocs.io/en/latest/usage.html#queries</a> for the idea.</p></li>
<li><p><strong>mongo_cursor</strong> is a super-charged cursor and in particular, it handles encoding and decoding of objects seemlessly in a way that allows us to store all that we want in Mongo.</p></li>
<li><p><strong>mongo_pk_cursor</strong> manages a table with primary keys and full history audit. We are happy to acknowledge Arctic by the AHL Man team for the initial inspiration</p></li>
</ul>
<div class="section" id="q">
<h2>q<a class="headerlink" href="#q" title="Permalink to this headline">¶</a></h2>
<p>The MongoDB interface for query of a collection (table) is via a creation of a query document <a class="reference external" href="https://docs.mongodb.com/manual/tutorial/query-documents/">https://docs.mongodb.com/manual/tutorial/query-documents/</a>. This is rather complicated for the average use. For example, if you wanted to locate James Bond in the collection, you would need to compose q query document that looks like this:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="p">{</span><span class="s2">&quot;$and&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;$eq&quot;</span><span class="p">:</span> <span class="s2">&quot;James&quot;</span><span class="p">}},</span> <span class="p">{</span><span class="s2">&quot;surname&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;$eq&quot;</span><span class="p">:</span> <span class="s2">&quot;Bond&quot;</span><span class="p">}}]}</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;$and&#39;: [{&#39;name&#39;: {&#39;$eq&#39;: &#39;James&#39;}}, {&#39;surname&#39;: {&#39;$eq&#39;: &#39;Bond&#39;}}]}
</pre></div></div>
</div>
<p>It’s doable, but not much fun writing. Luckily… within the continuum you can write this instead:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">pyg</span> <span class="kn">import</span> <span class="o">*</span><span class="p">;</span> <span class="kn">import</span> <span class="nn">re</span>
<span class="n">q</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;James&#39;</span><span class="p">,</span> <span class="n">surname</span> <span class="o">=</span> <span class="s1">&#39;Bond&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#34;$and&#34;: [{&#34;name&#34;: {&#34;$eq&#34;: &#34;James&#34;}}, {&#34;surname&#34;: {&#34;$eq&#34;: &#34;Bond&#34;}}]}
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;James&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">surname</span> <span class="o">==</span> <span class="s1">&#39;Bond&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#34;$and&#34;: [{&#34;name&#34;: {&#34;$eq&#34;: &#34;James&#34;}}, {&#34;surname&#34;: {&#34;$eq&#34;: &#34;Bond&#34;}}]}
</pre></div></div>
</div>
<p>How do we create in MongoDB a query document to find all the James who are not Bond?</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">surname</span><span class="o">!=</span><span class="s1">&#39;Bond&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;James&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#34;$and&#34;: [{&#34;name&#34;: {&#34;$eq&#34;: &#34;James&#34;}}, {&#34;surname&#34;: {&#34;$ne&#34;: &#34;Bond&#34;}}]}
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">~</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">surname</span><span class="o">==</span><span class="s1">&#39;Bond&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;James&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#34;$and&#34;: [{&#34;$not&#34;: {&#34;surname&#34;: {&#34;$eq&#34;: &#34;Bond&#34;}}}, {&#34;name&#34;: {&#34;$eq&#34;: &#34;James&#34;}}]}
</pre></div></div>
</div>
<p>What about records with no surname?</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;James&#39;</span><span class="p">)</span> <span class="o">-</span> <span class="n">q</span><span class="o">.</span><span class="n">surname</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#34;$and&#34;: [{&#34;name&#34;: {&#34;$eq&#34;: &#34;James&#34;}}, {&#34;surname&#34;: {&#34;$exists&#34;: false}}]}
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">q</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">surname</span><span class="o">.</span><span class="n">not_exists</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;James&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#34;$and&#34;: [{&#34;name&#34;: {&#34;$eq&#34;: &#34;James&#34;}}, {&#34;surname&#34;: {&#34;$exists&#34;: false}}]}
</pre></div></div>
</div>
<p>And what about records with james rather than James?</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">q</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;james&#39;</span><span class="p">,</span> <span class="s1">&#39;James&#39;</span><span class="p">],</span> <span class="n">surname</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;bond&#39;</span><span class="p">,</span> <span class="s1">&#39;Bond&#39;</span><span class="p">])</span> <span class="c1">## the result is long so it is represented more nicely...</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
$and:
    [{&#34;name&#34;: {&#34;$in&#34;: [&#34;james&#34;, &#34;James&#34;]}}, {&#34;surname&#34;: {&#34;$in&#34;: [&#34;bond&#34;, &#34;Bond&#34;]}}]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">q</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;^[J|j]ames&#39;</span><span class="p">),</span> <span class="n">surname</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;^[B|b]ond&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
$and:
    [{&#34;name&#34;: {&#34;regex&#34;: &#34;^[J|j]ames&#34;}}, {&#34;surname&#34;: {&#34;regex&#34;: &#34;^[B|b]ond&#34;}}]
</pre></div></div>
</div>
<p>As you can see, q is callable and you can put expressions inside it, or you can use the q.key method.</p>
<p>If you have funny characters or spaces in your dict…</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">q</span><span class="p">[</span><span class="s1">&#39;funny$text with # weird £ characters&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">exists</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#34;funny$text with # weird £ characters&#34;: {&#34;$exists&#34;: true}}
</pre></div></div>
</div>
<p>If your document is nested and there are subkeys, that is ok, you can use either:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="s1">&#39;key.subkey&#39;</span><span class="p">]</span><span class="o">&gt;=</span><span class="mi">100</span><span class="p">)</span> <span class="o">|</span> <span class="p">((</span><span class="n">q</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">other</span><span class="o">.</span><span class="n">exists</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">some</span><span class="o">.</span><span class="n">other</span><span class="o">.</span><span class="n">stuff</span> <span class="o">==</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
$or:
    mdict
    $and:
        [{&#34;key.other&#34;: {&#34;$exists&#34;: true}}, {&#34;some.other.stuff&#34;: {&#34;$in&#34;: [1, 2]}}]
    M{&#34;key.subkey&#34;: {&#34;$gte&#34;: 100}}
</pre></div></div>
</div>
<p>q does not have the full power of the Mongo query document but it will get you to 95% of what you want. We end with a fun James Bond query. If we want to find the bond films with all actors who played James Bond after 1980…</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">bonds</span> <span class="o">=</span> <span class="n">dictable</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Daniel&#39;</span><span class="p">,</span> <span class="s1">&#39;Sean&#39;</span><span class="p">,</span> <span class="s1">&#39;Roger&#39;</span><span class="p">,</span> <span class="s1">&#39;Timothy&#39;</span><span class="p">],</span> <span class="n">surname</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Craig&#39;</span><span class="p">,</span> <span class="s1">&#39;Connery&#39;</span><span class="p">,</span> <span class="s1">&#39;Moore&#39;</span><span class="p">,</span> <span class="s1">&#39;Dalton&#39;</span><span class="p">])</span>
<span class="n">bonds</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
dictable[4 x 2]
name   |surname
Daniel |Craig
Sean   |Connery
Roger  |Moore
Timothy|Dalton
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">q</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">bonds</span><span class="p">),</span> <span class="n">q</span><span class="o">.</span><span class="n">release_date</span> <span class="o">&gt;</span> <span class="n">dt</span><span class="p">(</span><span class="mi">1980</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
$and:
    mdict
    $or:
        M{&#34;$and&#34;: [{&#34;name&#34;: {&#34;$eq&#34;: &#34;Daniel&#34;}}, {&#34;surname&#34;: {&#34;$eq&#34;: &#34;Craig&#34;}}]}
        M{&#34;$and&#34;: [{&#34;name&#34;: {&#34;$eq&#34;: &#34;Roger&#34;}}, {&#34;surname&#34;: {&#34;$eq&#34;: &#34;Moore&#34;}}]}
        M{&#34;$and&#34;: [{&#34;name&#34;: {&#34;$eq&#34;: &#34;Sean&#34;}}, {&#34;surname&#34;: {&#34;$eq&#34;: &#34;Connery&#34;}}]}
        M{&#34;$and&#34;: [{&#34;name&#34;: {&#34;$eq&#34;: &#34;Timothy&#34;}}, {&#34;surname&#34;: {&#34;$eq&#34;: &#34;Dalton&#34;}}]}
    M{&#34;release_date&#34;: {&#34;$gt&#34;: datetime.datetime(1980, 1, 1, 0, 0)}}
</pre></div></div>
</div>
</div>
<div class="section" id="mongo_cursor">
<h2>mongo_cursor<a class="headerlink" href="#mongo_cursor" title="Permalink to this headline">¶</a></h2>
<p>The mongo cursor:</p>
<ul class="simple">
<li><p>enables saving seemlessly objects and data in MongoDB</p></li>
<li><p>simplifies filtering</p></li>
<li><p>simplifies projecting onto certain keys in document</p></li>
</ul>
<div class="section" id="general-objects-insertion-into-documents">
<h3>general objects insertion into documents<a class="headerlink" href="#general-objects-insertion-into-documents" title="Permalink to this headline">¶</a></h3>
<p>pymongo.Collection supports insertion of documents into it:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">pyg</span> <span class="kn">import</span> <span class="o">*</span><span class="p">;</span> <span class="kn">import</span> <span class="nn">pymongo</span> <span class="k">as</span> <span class="nn">pym</span><span class="p">;</span> <span class="kn">import</span> <span class="nn">pytest</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">pym</span><span class="o">.</span><span class="n">MongoClient</span><span class="p">()[</span><span class="s1">&#39;test&#39;</span><span class="p">][</span><span class="s1">&#39;test&#39;</span><span class="p">]</span>
<span class="n">c</span><span class="o">.</span><span class="n">drop</span><span class="p">()</span>                                    <span class="c1"># drop all documents</span>
<span class="n">c</span><span class="o">.</span><span class="n">insert_one</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">2</span><span class="p">))</span>            <span class="c1"># insert a document</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;pymongo.results.InsertOneResult at 0x2d26bf25280&gt;
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">assert</span> <span class="n">c</span><span class="o">.</span><span class="n">count_documents</span><span class="p">({})</span> <span class="o">==</span> <span class="mi">1</span>  <span class="c1"># in order to count documents, must apply the empty query document {}</span>
</pre></div>
</div>
</div>
<p>We can do similar stuff with a mongo_cursor:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">t</span> <span class="o">=</span> <span class="n">mongo_table</span><span class="p">(</span><span class="n">table</span> <span class="o">=</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="n">db</span> <span class="o">=</span> <span class="s1">&#39;test&#39;</span><span class="p">)</span>
<span class="n">t</span><span class="o">.</span><span class="n">drop</span><span class="p">()</span>
<span class="n">t</span><span class="o">.</span><span class="n">insert_one</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
2021-03-07 20:42:47,719 - pyg - INFO - INFO: deleting 1 documents based on M{}
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;a&#39;: 1, &#39;b&#39;: 2, &#39;_id&#39;: ObjectId(&#39;60453ac70e096da27d7d20bf&#39;)}
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="c1">#no need to specify the filter, mongo_cursor keeps track of the current filter</span>
</pre></div>
</div>
</div>
<p>Annoyingly, raw pymongo.Collection cannot encode for lots of existing objects.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">ts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="mf">1.</span><span class="p">,</span><span class="mf">2.</span><span class="p">],</span> <span class="n">drange</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">(</span><span class="mf">32.0</span><span class="p">)</span>
<span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="n">c</span><span class="o">.</span><span class="n">insert_one</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">a</span> <span class="o">=</span> <span class="n">a</span><span class="p">))</span> <span class="c1"># cannot insert an array</span>
<span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="n">c</span><span class="o">.</span><span class="n">insert_one</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">f</span> <span class="o">=</span> <span class="n">f</span><span class="p">))</span> <span class="c1"># cannot insert a numpy float, string or bool</span>
<span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="n">c</span><span class="o">.</span><span class="n">insert_one</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">ts</span> <span class="o">=</span> <span class="n">ts</span><span class="p">))</span>  <span class="c1"># cannot insert a pd.Series or DataFrame</span>
</pre></div>
</div>
</div>
<p>Further, unless we define the encoding, new classes do not work either</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">class</span> <span class="nc">NewClass</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">n</span>
    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="o">==</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">n</span>
<span class="n">n</span> <span class="o">=</span> <span class="n">NewClass</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="n">c</span><span class="o">.</span><span class="n">insert_one</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">n</span> <span class="o">=</span> <span class="n">n</span><span class="p">))</span>
</pre></div>
</div>
</div>
<p>Luckily, the mongo_cursor t can insert all these happily:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">t</span><span class="o">.</span><span class="n">drop</span><span class="p">()</span>
<span class="n">t</span><span class="o">.</span><span class="n">insert_one</span><span class="p">(</span><span class="n">Dict</span><span class="p">(</span><span class="n">a</span> <span class="o">=</span> <span class="n">a</span><span class="p">,</span> <span class="n">f</span> <span class="o">=</span> <span class="n">f</span><span class="p">,</span> <span class="n">ts</span> <span class="o">=</span> <span class="n">ts</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="n">n</span><span class="p">))</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
<span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1">## reading it back</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
2021-03-07 20:42:47,836 - pyg - INFO - INFO: deleting 1 documents based on M{}
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;_id&#39;: ObjectId(&#39;60453ac70e096da27d7d20c4&#39;),
 &#39;a&#39;: array([0, 1, 2]),
 &#39;f&#39;: 32.0,
 &#39;ts&#39;: 2000-01-01    1.0
 2000-01-02    2.0
 dtype: float64,
 &#39;n&#39;: &lt;__main__.NewClass at 0x2d26c6439d0&gt;}
</pre></div></div>
</div>
</div>
<div class="section" id="document-reading">
<h3>document reading<a class="headerlink" href="#document-reading" title="Permalink to this headline">¶</a></h3>
<p>What is nice is that when you read the document using the mongo_cursor, you get back the <strong>object</strong> you saved, not just the data. Is this magic? Not really… We read the doc directly from the Collection:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">raw_doc</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">find_one</span><span class="p">({})</span>
<span class="k">assert</span> <span class="n">raw_doc</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;{&quot;py/object&quot;: &quot;__main__.NewClass&quot;, &quot;n&quot;: 1}&#39;</span>
<span class="k">assert</span> <span class="n">encode</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;{&quot;py/object&quot;: &quot;__main__.NewClass&quot;, &quot;n&quot;: 1}&#39;</span>
<span class="k">assert</span> <span class="n">decode</span><span class="p">(</span><span class="s1">&#39;{&quot;py/object&quot;: &quot;__main__.NewClass&quot;, &quot;n&quot;: 1}&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">n</span>
<span class="k">assert</span> <span class="n">t</span><span class="o">.</span><span class="n">writer</span> <span class="o">==</span> <span class="n">encode</span>
<span class="k">assert</span> <span class="n">t</span><span class="o">.</span><span class="n">reader</span> <span class="o">==</span> <span class="n">decode</span>
</pre></div>
</div>
</div>
<ul class="simple">
<li><p>When writing, the mongo_cursor encodes the objects pre-saving it into Mongo, in this case as a simple dict</p></li>
<li><p>When reading, it uses decode to convert what it reads back into the object</p></li>
<li><p>This is done transparently though you can have full control via specifying writer/reader functions</p></li>
</ul>
<p>This all works with the assumption that the person loading and the person saving share the library so objects can be instantiated on load. If construction method has changed and the object is not back-compatible, then user will receive the undecoded object and a warning message is logged.</p>
</div>
<div class="section" id="document-writing-to-files">
<h3>document writing to files<a class="headerlink" href="#document-writing-to-files" title="Permalink to this headline">¶</a></h3>
<p>MongoDB is great for manipulating/searching dict keys/values. The actual dataframes in each doc, we may want to save in a file system because:</p>
<ul class="simple">
<li><p>DataFrames are stored as bytes in MongoDB anyway, so they are not searchable</p></li>
<li><p>Storing in files allows other non-python/non-MongoDB users easier access, allowing data to be detached from app</p></li>
<li><p>MongoDB free version has limitations on size of document</p></li>
<li><p>For data licensing issues, data must not sit on servers but needs to be stored on local computer</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">t2</span> <span class="o">=</span> <span class="n">mongo_table</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="n">writer</span> <span class="o">=</span> <span class="s1">&#39;parquet&#39;</span><span class="p">)</span>
<span class="n">t2</span><span class="o">.</span><span class="n">drop</span><span class="p">()</span>
<span class="n">doc</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">root</span> <span class="o">=</span> <span class="s1">&#39;c:/temp&#39;</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">a</span><span class="p">],</span> <span class="n">ts</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">one</span> <span class="o">=</span> <span class="n">ts</span><span class="p">,</span> <span class="n">two</span> <span class="o">=</span> <span class="n">ts</span><span class="p">),</span> <span class="n">f</span> <span class="o">=</span> <span class="n">f</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="n">n</span><span class="p">)</span>  <span class="c1">## can handle lists of arrays or dicts of stuff</span>
<span class="n">t2</span><span class="o">.</span><span class="n">insert_one</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
<span class="n">encoded</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">find_one</span><span class="p">({})</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tree_repr</span><span class="p">(</span><span class="n">encoded</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
2021-03-07 20:42:47,907 - pyg - INFO - INFO: deleting 1 documents based on M{}
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
_id:
    60453ac90e096da27d7d20c6
root:
    c:/temp
a:
    {&#39;_obj&#39;: &#39;{&#34;py/function&#34;: &#34;numpy.load&#34;}&#39;, &#39;file&#39;: &#39;c:/temp/a/0.npy&#39;}
    {&#39;_obj&#39;: &#39;{&#34;py/function&#34;: &#34;numpy.load&#34;}&#39;, &#39;file&#39;: &#39;c:/temp/a/1.npy&#39;}
    {&#39;_obj&#39;: &#39;{&#34;py/function&#34;: &#34;numpy.load&#34;}&#39;, &#39;file&#39;: &#39;c:/temp/a/2.npy&#39;}
ts:
    one:
        _obj:
            {&#34;py/function&#34;: &#34;pyg.base._parquet.pd_read_parquet&#34;}
        path:
            c:/temp/ts/one.parquet
    two:
        _obj:
            {&#34;py/function&#34;: &#34;pyg.base._parquet.pd_read_parquet&#34;}
        path:
            c:/temp/ts/two.parquet
f:
    32.0
n:
    {&#34;py/object&#34;: &#34;__main__.NewClass&#34;, &#34;n&#34;: 1}
</pre></div></div>
</div>
<p>You can see that starting at the root location, the document’s numpy arrays and pandas have been saved to .npy and .parquet files</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">print</span><span class="p">(</span><span class="n">tree_repr</span><span class="p">(</span><span class="n">decode</span><span class="p">(</span><span class="n">encoded</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
_id:
    60453ac90e096da27d7d20c6
root:
    c:/temp
a:
    [array([0, 1, 2]), array([0, 1, 2]), array([0, 1, 2])]
ts:
    one:
        index
        2000-01-01    1.0
        2000-01-02    2.0
        dtype: float64
    two:
        index
        2000-01-01    1.0
        2000-01-02    2.0
        dtype: float64
f:
    32.0
n:
    &lt;__main__.NewClass object at 0x000002D26CAFEC10&gt;
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;c:/temp/a/2.npy&#39;</span><span class="p">)</span> <span class="c1">## can load data directly</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([0, 1, 2])
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">pd_read_parquet</span><span class="p">(</span><span class="s1">&#39;c:/temp/ts/one.parquet&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
index
2000-01-01    1.0
2000-01-02    2.0
dtype: float64
</pre></div></div>
</div>
</div>
<div class="section" id="document-access">
<h3>document access<a class="headerlink" href="#document-access" title="Permalink to this headline">¶</a></h3>
<p>We start by pushing a 10x10 times table into t</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">t</span><span class="o">.</span><span class="n">drop</span><span class="p">()</span>
<span class="n">times_table</span> <span class="o">=</span> <span class="p">(</span><span class="n">dictable</span><span class="p">(</span><span class="n">a</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span> <span class="o">*</span> <span class="n">dictable</span><span class="p">(</span><span class="n">b</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)))(</span><span class="n">c</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">a</span><span class="o">*</span><span class="n">b</span><span class="p">)</span>
<span class="n">t</span><span class="o">.</span><span class="n">insert_many</span><span class="p">(</span><span class="n">times_table</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
2021-03-07 20:42:49,637 - pyg - INFO - INFO: deleting 1 documents based on M{}
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;class &#39;pyg.mongo._cursor.mongo_cursor&#39;&gt; for Collection(Database(MongoClient(host=[&#39;localhost:27017&#39;], document_class=dict, tz_aware=False, connect=True), &#39;test&#39;), &#39;test&#39;)
M{} None
documents count: 100
dict_keys([&#39;_id&#39;, &#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;_obj&#39;])
</pre></div></div>
</div>
</div>
<div class="section" id="filters">
<h3>filters<a class="headerlink" href="#filters" title="Permalink to this headline">¶</a></h3>
<p>We now examine how we drill down to the document(s) we want:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">inc</span><span class="p">(</span><span class="n">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">))</span> <span class="o">==</span> <span class="mi">10</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">exc</span><span class="p">(</span><span class="n">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">))</span> <span class="o">==</span> <span class="mi">90</span>
<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">inc</span><span class="p">(</span><span class="n">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">),</span> <span class="n">mongo_cursor</span><span class="p">)</span> <span class="c1">## it is chain-able</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">a</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">b</span> <span class="o">==</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">]))</span> <span class="o">==</span> <span class="mi">4</span>
</pre></div>
</div>
</div>
<p>We can use the original collection too but not in a chain-like fashion:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">spec</span> <span class="o">=</span> <span class="n">q</span><span class="p">(</span><span class="n">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">])</span>
<span class="k">assert</span> <span class="n">c</span><span class="o">.</span><span class="n">count_documents</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span>
<span class="n">c</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span> <span class="c1"># That is OK</span>
<span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">AttributeError</span><span class="p">):</span>  <span class="c1"># not OK, cannot chain queries</span>
    <span class="n">c</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">q</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">q</span><span class="p">(</span><span class="n">b</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">]))</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="iteration">
<h3>iteration<a class="headerlink" href="#iteration" title="Permalink to this headline">¶</a></h3>
<p>Just like a mongo.Cursor, c.find(spec), t is also iterable over the documents:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">sum</span><span class="p">([</span><span class="n">doc</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">t</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">b</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">])],</span> <span class="n">dictable</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
dictable[4 x 4]
_id                     |a|b|c
60453ac90e096da27d7d20d2|1|1|1
60453ac90e096da27d7d20d3|1|2|2
60453ac90e096da27d7d20d4|1|3|3
60453ac90e096da27d7d20d5|1|4|4
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">dictable</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">b</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">]))</span> <span class="c1">## or just put a cursor straight into a table</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
dictable[4 x 4]
_id                     |a|b|c
60453ac90e096da27d7d20d2|1|1|1
60453ac90e096da27d7d20d3|1|2|2
60453ac90e096da27d7d20d4|1|3|3
60453ac90e096da27d7d20d5|1|4|4
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">t</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">b</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">])[::]</span> <span class="c1">## or simple slicing</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
dictable[4 x 4]
_id                     |a|b|c
60453ac90e096da27d7d20d2|1|1|1
60453ac90e096da27d7d20d3|1|2|2
60453ac90e096da27d7d20d4|1|3|3
60453ac90e096da27d7d20d5|1|4|4
</pre></div></div>
</div>
</div>
<div class="section" id="sorting">
<h3>sorting<a class="headerlink" href="#sorting" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">t</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">)[::]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
dictable[100 x 4]
_id                     |a|b|c
60453ac90e096da27d7d20c7|0|0|0
60453ac90e096da27d7d20d1|1|0|0
60453ac90e096da27d7d20db|2|0|0
...100 rows...
60453ac90e096da27d7d2129|9|8|72
60453ac90e096da27d7d2120|8|9|72
60453ac90e096da27d7d212a|9|9|81
</pre></div></div>
</div>
</div>
<div class="section" id="getitem-of-a-specfic-document">
<h3>getitem of a specfic document<a class="headerlink" href="#getitem-of-a-specfic-document" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">t</span><span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="n">a</span> <span class="o">=</span> <span class="mi">7</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">8</span><span class="p">)]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;_id&#39;: ObjectId(&#39;60453ac90e096da27d7d2115&#39;), &#39;a&#39;: 7, &#39;b&#39;: 8, &#39;c&#39;: 56}
</pre></div></div>
</div>
</div>
<div class="section" id="column-access">
<h3>column access<a class="headerlink" href="#column-access" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">t</span><span class="o">.</span><span class="n">b</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">assert</span> <span class="n">t</span><span class="o">.</span><span class="n">b</span> <span class="o">==</span> <span class="n">t</span><span class="o">.</span><span class="n">distinct</span><span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">c</span><span class="o">.</span><span class="n">distinct</span><span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>In MongoDB the cursor can have a ‘projection’ onto specific columns. In mongo_cursor this is simplified:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">t</span><span class="p">[[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">c</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)[::]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
dictable[4 x 3]
_id                     |a|b
60453ac90e096da27d7d2105|6|2
60453ac90e096da27d7d20f2|4|3
60453ac90e096da27d7d20e9|3|4
60453ac90e096da27d7d20e1|2|6
</pre></div></div>
</div>
</div>
<div class="section" id="add/remove-columns">
<h3>add/remove columns<a class="headerlink" href="#add/remove-columns" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">del</span> <span class="n">t</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">]</span>
<span class="n">t</span><span class="p">[::]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
dictable[100 x 3]
_id                     |a|b
60453ac90e096da27d7d20c7|0|0
60453ac90e096da27d7d20d1|1|0
60453ac90e096da27d7d20db|2|0
...100 rows...
60453ac90e096da27d7d2116|7|9
60453ac90e096da27d7d2120|8|9
60453ac90e096da27d7d212a|9|9
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">c</span> <span class="o">=</span> <span class="s1">&#39;not very useful but...&#39;</span><span class="p">)</span>
<span class="n">t</span><span class="p">[::]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
dictable[100 x 4]
_id                     |a|b|c
60453ac90e096da27d7d20c7|0|0|not very useful but...
60453ac90e096da27d7d20d1|1|0|not very useful but...
60453ac90e096da27d7d20db|2|0|not very useful but...
...100 rows...
60453ac90e096da27d7d2116|7|9|not very useful but...
60453ac90e096da27d7d2120|8|9|not very useful but...
60453ac90e096da27d7d212a|9|9|not very useful but...
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">c</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">a</span> <span class="o">*</span> <span class="n">b</span><span class="p">)</span> <span class="c1">### more useful</span>
<span class="n">t</span><span class="p">[::]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
dictable[100 x 4]
_id                     |a|b|c
60453ac90e096da27d7d20c7|0|0|0
60453ac90e096da27d7d20d1|1|0|0
60453ac90e096da27d7d20db|2|0|0
...100 rows...
60453ac90e096da27d7d2129|9|8|72
60453ac90e096da27d7d2120|8|9|72
60453ac90e096da27d7d212a|9|9|81
</pre></div></div>
</div>
</div>
<div class="section" id="add/remove-records">
<h3>add/remove records<a class="headerlink" href="#add/remove-records" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">t</span><span class="o">.</span><span class="n">inc</span><span class="p">(</span><span class="n">c</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span><span class="o">.</span><span class="n">drop</span><span class="p">()</span>
<span class="n">t</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
2021-03-07 20:42:51,028 - pyg - INFO - INFO: deleting 4 documents based on M{&#39;c&#39;: {&#39;$eq&#39;: 12}}
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;class &#39;pyg.mongo._cursor.mongo_cursor&#39;&gt; for Collection(Database(MongoClient(host=[&#39;localhost:27017&#39;], document_class=dict, tz_aware=False, connect=True), &#39;test&#39;), &#39;test&#39;)
M{} None
documents count: 96
dict_keys([&#39;_id&#39;, &#39;a&#39;, &#39;b&#39;, &#39;_obj&#39;, &#39;c&#39;])
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">t</span> <span class="o">=</span> <span class="n">t</span> <span class="o">+</span> <span class="nb">dict</span><span class="p">(</span><span class="n">a</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">t</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;class &#39;pyg.mongo._cursor.mongo_cursor&#39;&gt; for Collection(Database(MongoClient(host=[&#39;localhost:27017&#39;], document_class=dict, tz_aware=False, connect=True), &#39;test&#39;), &#39;test&#39;)
M{} None
documents count: 97
dict_keys([&#39;_id&#39;, &#39;a&#39;, &#39;b&#39;, &#39;_obj&#39;, &#39;c&#39;])
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[42]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">inc</span><span class="p">(</span><span class="n">c</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span><span class="o">.</span><span class="n">drop</span><span class="p">()</span> <span class="o">+</span> <span class="n">times_table</span><span class="o">.</span><span class="n">inc</span><span class="p">(</span><span class="n">c</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span> <span class="c1">## adding four records at once</span>
<span class="n">t</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
2021-03-07 20:42:51,073 - pyg - INFO - INFO: deleting 1 documents based on M{&#39;c&#39;: {&#39;$eq&#39;: 12}}
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[42]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;class &#39;pyg.mongo._cursor.mongo_cursor&#39;&gt; for Collection(Database(MongoClient(host=[&#39;localhost:27017&#39;], document_class=dict, tz_aware=False, connect=True), &#39;test&#39;), &#39;test&#39;)
M{&#39;c&#39;: {&#39;$eq&#39;: 12}} None
documents count: 4
dict_keys([&#39;_id&#39;, &#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;_obj&#39;])
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[43]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">inc</span><span class="p">(</span><span class="n">c</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span><span class="o">.</span><span class="n">drop</span><span class="p">()</span><span class="o">.</span><span class="n">insert_many</span><span class="p">(</span><span class="n">times_table</span><span class="o">.</span><span class="n">inc</span><span class="p">(</span><span class="n">c</span> <span class="o">=</span> <span class="mi">12</span><span class="p">))</span>
<span class="n">t</span><span class="p">[::]</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
2021-03-07 20:42:51,099 - pyg - INFO - INFO: deleting 4 documents based on M{&#39;c&#39;: {&#39;$eq&#39;: 12}}
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[43]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
dictable[4 x 4]
_id                     |a|b|c
60453acb0e096da27d7d2133|6|2|12
60453acb0e096da27d7d2132|4|3|12
60453acb0e096da27d7d2131|3|4|12
60453acb0e096da27d7d2130|2|6|12
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[44]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">raw</span> <span class="c1">## remove the filter c = 12</span>
<span class="n">t</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[44]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;class &#39;pyg.mongo._cursor.mongo_cursor&#39;&gt; for Collection(Database(MongoClient(host=[&#39;localhost:27017&#39;], document_class=dict, tz_aware=False, connect=True), &#39;test&#39;), &#39;test&#39;)
M{} None
documents count: 100
dict_keys([&#39;_id&#39;, &#39;a&#39;, &#39;b&#39;, &#39;_obj&#39;, &#39;c&#39;])
</pre></div></div>
</div>
</div>
</div>
<div class="section" id="mongo_pk_table">
<h2>mongo_pk_table<a class="headerlink" href="#mongo_pk_table" title="Permalink to this headline">¶</a></h2>
<p>mongo_pk_table is a mongo_cursor implementing a table with primary keys. Suppose we want to have a table of people:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[70]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">pyg</span> <span class="kn">import</span> <span class="o">*</span><span class="p">;</span> <span class="kn">import</span> <span class="nn">pymongo</span> <span class="k">as</span> <span class="nn">pym</span><span class="p">;</span> <span class="kn">import</span> <span class="nn">pytest</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">mongo_table</span><span class="p">(</span><span class="n">table</span> <span class="o">=</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="n">db</span> <span class="o">=</span> <span class="s1">&#39;test&#39;</span><span class="p">)</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">pym</span><span class="o">.</span><span class="n">MongoClient</span><span class="p">()[</span><span class="s1">&#39;test&#39;</span><span class="p">][</span><span class="s1">&#39;test&#39;</span><span class="p">]</span>
<span class="n">pk</span> <span class="o">=</span> <span class="n">mongo_table</span><span class="p">(</span><span class="n">table</span> <span class="o">=</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="n">db</span> <span class="o">=</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="n">pk</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;surname&#39;</span><span class="p">])</span>

<span class="n">t</span><span class="o">.</span><span class="n">drop</span><span class="p">()</span>
<span class="n">d</span> <span class="o">=</span> <span class="n">dictable</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;alan&#39;</span><span class="p">,</span> <span class="s1">&#39;alan&#39;</span><span class="p">,</span> <span class="s1">&#39;barbara&#39;</span><span class="p">,</span> <span class="s1">&#39;chris&#39;</span><span class="p">],</span> <span class="n">surname</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;adams&#39;</span><span class="p">,</span> <span class="s1">&#39;jones&#39;</span><span class="p">,</span> <span class="s1">&#39;brown&#39;</span><span class="p">,</span> <span class="s1">&#39;jones&#39;</span><span class="p">],</span> <span class="n">age</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">])</span>
<span class="n">pk</span><span class="o">.</span><span class="n">insert_many</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
<span class="n">pk</span><span class="p">[::]</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
2021-03-07 21:04:34,232 - pyg - INFO - INFO: deleting 8 documents based on M{}
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[70]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
dictable[4 x 5]
_id                     |_pk                |age|name   |surname
60453fe20e096da27d7d2150|[&#39;name&#39;, &#39;surname&#39;]|1  |alan   |adams
60453fe20e096da27d7d2151|[&#39;name&#39;, &#39;surname&#39;]|2  |alan   |jones
60453fe20e096da27d7d2152|[&#39;name&#39;, &#39;surname&#39;]|3  |barbara|brown
60453fe20e096da27d7d2153|[&#39;name&#39;, &#39;surname&#39;]|4  |chris  |jones
</pre></div></div>
</div>
<p>Now let us suppose a year has passed…</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[71]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">pk</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">age</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">age</span><span class="p">:</span> <span class="n">age</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">pk</span><span class="p">[::]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[71]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
dictable[4 x 5]
_id                     |_pk                |age|name   |surname
60453fe20e096da27d7d2150|[&#39;name&#39;, &#39;surname&#39;]|2  |alan   |adams
60453fe20e096da27d7d2151|[&#39;name&#39;, &#39;surname&#39;]|3  |alan   |jones
60453fe20e096da27d7d2152|[&#39;name&#39;, &#39;surname&#39;]|4  |barbara|brown
60453fe20e096da27d7d2153|[&#39;name&#39;, &#39;surname&#39;]|5  |chris  |jones
</pre></div></div>
</div>
<p>The pk-table actually maintains complete audit trail. Older records are not deleted, they just get ’_deleted’ parameter set for them.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[72]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">print</span><span class="p">(</span><span class="n">dictable</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
_pk                |name   |_obj                              |age|_deleted                  |_id                     |surname
[&#39;name&#39;, &#39;surname&#39;]|alan   |{&#34;py/type&#34;: &#34;pyg.base._dict.Dict&#34;}|2  |None                      |60453fe20e096da27d7d2150|adams
[&#39;name&#39;, &#39;surname&#39;]|alan   |{&#34;py/type&#34;: &#34;pyg.base._dict.Dict&#34;}|3  |None                      |60453fe20e096da27d7d2151|jones
[&#39;name&#39;, &#39;surname&#39;]|barbara|{&#34;py/type&#34;: &#34;pyg.base._dict.Dict&#34;}|4  |None                      |60453fe20e096da27d7d2152|brown
[&#39;name&#39;, &#39;surname&#39;]|chris  |{&#34;py/type&#34;: &#34;pyg.base._dict.Dict&#34;}|5  |None                      |60453fe20e096da27d7d2153|jones
[&#39;name&#39;, &#39;surname&#39;]|alan   |{&#34;py/type&#34;: &#34;pyg.base._dict.Dict&#34;}|1  |2021-03-07 21:04:34.284000|60453fe20e096da27d7d2154|adams
[&#39;name&#39;, &#39;surname&#39;]|alan   |{&#34;py/type&#34;: &#34;pyg.base._dict.Dict&#34;}|2  |2021-03-07 21:04:34.289000|60453fe20e096da27d7d2155|jones
[&#39;name&#39;, &#39;surname&#39;]|barbara|{&#34;py/type&#34;: &#34;pyg.base._dict.Dict&#34;}|3  |2021-03-07 21:04:34.293000|60453fe20e096da27d7d2156|brown
[&#39;name&#39;, &#39;surname&#39;]|chris  |{&#34;py/type&#34;: &#34;pyg.base._dict.Dict&#34;}|4  |2021-03-07 21:04:34.298000|60453fe20e096da27d7d2157|jones
</pre></div></div>
</div>
<p>You can see pk only looks at records where _deleted does not exist and _pk are set.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[73]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">pk</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[73]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;class &#39;pyg.mongo._pk_cursor.mongo_pk_cursor&#39;&gt; for Collection(Database(MongoClient(host=[&#39;localhost:27017&#39;], document_class=dict, tz_aware=False, connect=True), &#39;test&#39;), &#39;test&#39;)
M{&#39;$and&#39;: [{&#34;_deleted&#34;: {&#34;$exists&#34;: false}}, {&#34;_pk&#34;: {&#34;$eq&#34;: [&#34;name&#34;, &#34;surname&#34;]}}]} None
documents count: 4
dict_keys([&#39;_id&#39;, &#39;_obj&#39;, &#39;_pk&#39;, &#39;age&#39;, &#39;name&#39;, &#39;surname&#39;])
</pre></div></div>
</div>
<p>There are obvioursly some small differences on how pk works but broadly, it is just like a normal mongo_cursor with an added filter to zoom onto the records that maintain the primary-key table:</p>
<ul class="simple">
<li><p>you cannot insert docs without primary keys all present:</p></li>
<li><p>the drop() command does not actually delete the documents, they are simply ‘marked’ as deleted.</p></li>
<li><p>to get from a mongo_pk_cursor to mongo_cursor, simply go pk.raw</p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[74]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">KeyError</span><span class="p">):</span>
    <span class="n">pk</span><span class="o">.</span><span class="n">insert_one</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">no_name_or_surname</span> <span class="o">=</span> <span class="s1">&#39;James&#39;</span><span class="p">))</span> <span class="c1"># cannot insert with no PK</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[75]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">pk</span><span class="o">.</span><span class="n">drop</span><span class="p">()</span>
<span class="nb">len</span><span class="p">(</span><span class="n">pk</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[75]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[76]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">t</span><span class="p">[::]</span> <span class="c1">## the data is there, it is just marked as _deleted</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[76]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
dictable[8 x 6]
_deleted                  |_id                     |_pk                |age|name   |surname
2021-03-07 21:04:34.355000|60453fe20e096da27d7d2150|[&#39;name&#39;, &#39;surname&#39;]|2  |alan   |adams
2021-03-07 21:04:34.355000|60453fe20e096da27d7d2151|[&#39;name&#39;, &#39;surname&#39;]|3  |alan   |jones
2021-03-07 21:04:34.355000|60453fe20e096da27d7d2152|[&#39;name&#39;, &#39;surname&#39;]|4  |barbara|brown
...8 rows...
2021-03-07 21:04:34.289000|60453fe20e096da27d7d2155|[&#39;name&#39;, &#39;surname&#39;]|2  |alan   |jones
2021-03-07 21:04:34.293000|60453fe20e096da27d7d2156|[&#39;name&#39;, &#39;surname&#39;]|3  |barbara|brown
2021-03-07 21:04:34.298000|60453fe20e096da27d7d2157|[&#39;name&#39;, &#39;surname&#39;]|4  |chris  |jones
</pre></div></div>
</div>
</div>
<div class="section" id="mongo_reader-and-mongo_pk_reader">
<h2>mongo_reader and mongo_pk_reader<a class="headerlink" href="#mongo_reader-and-mongo_pk_reader" title="Permalink to this headline">¶</a></h2>
<p>Because it is so easy to do stuff in MongoDB, we could easily cause damage to the date underlying. We therefore also introduced read-only versions for the mongo_cursor and pk_cursor:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[77]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">pkr</span> <span class="o">=</span> <span class="n">mongo_table</span><span class="p">(</span><span class="n">table</span> <span class="o">=</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="n">db</span> <span class="o">=</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="n">pk</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;surname&#39;</span><span class="p">],</span> <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">pkr</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[77]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;class &#39;pyg.mongo._pk_reader.mongo_pk_reader&#39;&gt; for Collection(Database(MongoClient(host=[&#39;localhost:27017&#39;], document_class=dict, tz_aware=False, connect=True), &#39;test&#39;), &#39;test&#39;)
M{&#39;$and&#39;: [{&#34;_deleted&#34;: {&#34;$exists&#34;: false}}, {&#34;_pk&#34;: {&#34;$eq&#34;: [&#34;name&#34;, &#34;surname&#34;]}}]} None
documents count: 0
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[78]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">AttributeError</span><span class="p">):</span>
    <span class="n">pkr</span><span class="o">.</span><span class="n">drop</span><span class="p">()</span>

</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[80]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">r</span>  <span class="o">=</span> <span class="n">mongo_table</span><span class="p">(</span><span class="n">table</span> <span class="o">=</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="n">db</span> <span class="o">=</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">AttributeError</span><span class="p">):</span>
    <span class="n">r</span><span class="o">.</span><span class="n">drop</span><span class="p">()</span>

<span class="n">r</span><span class="p">[::]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[80]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
dictable[8 x 6]
_deleted                  |_id                     |_pk                |age|name   |surname
2021-03-07 21:04:34.355000|60453fe20e096da27d7d2150|[&#39;name&#39;, &#39;surname&#39;]|2  |alan   |adams
2021-03-07 21:04:34.355000|60453fe20e096da27d7d2151|[&#39;name&#39;, &#39;surname&#39;]|3  |alan   |jones
2021-03-07 21:04:34.355000|60453fe20e096da27d7d2152|[&#39;name&#39;, &#39;surname&#39;]|4  |barbara|brown
...8 rows...
2021-03-07 21:04:34.289000|60453fe20e096da27d7d2155|[&#39;name&#39;, &#39;surname&#39;]|2  |alan   |jones
2021-03-07 21:04:34.293000|60453fe20e096da27d7d2156|[&#39;name&#39;, &#39;surname&#39;]|3  |barbara|brown
2021-03-07 21:04:34.298000|60453fe20e096da27d7d2157|[&#39;name&#39;, &#39;surname&#39;]|4  |chris  |jones
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">pyg</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../includeme.html">README</a></li>
<li class="toctree-l1"><a class="reference internal" href="../base.html">pyg.base</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mongo.html">pyg.mongo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../timeseries.html">pyg.timeseries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial_dict.html">pyg.base.Dict</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial_dictable.html">pyg.base.dictable</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">pyg.mongo</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#q">q</a></li>
<li class="toctree-l2"><a class="reference internal" href="#mongo_cursor">mongo_cursor</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#general-objects-insertion-into-documents">general objects insertion into documents</a></li>
<li class="toctree-l3"><a class="reference internal" href="#document-reading">document reading</a></li>
<li class="toctree-l3"><a class="reference internal" href="#document-writing-to-files">document writing to files</a></li>
<li class="toctree-l3"><a class="reference internal" href="#document-access">document access</a></li>
<li class="toctree-l3"><a class="reference internal" href="#filters">filters</a></li>
<li class="toctree-l3"><a class="reference internal" href="#iteration">iteration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#sorting">sorting</a></li>
<li class="toctree-l3"><a class="reference internal" href="#getitem-of-a-specfic-document">getitem of a specfic document</a></li>
<li class="toctree-l3"><a class="reference internal" href="#column-access">column access</a></li>
<li class="toctree-l3"><a class="reference internal" href="#add/remove-columns">add/remove columns</a></li>
<li class="toctree-l3"><a class="reference internal" href="#add/remove-records">add/remove records</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#mongo_pk_table">mongo_pk_table</a></li>
<li class="toctree-l2"><a class="reference internal" href="#mongo_reader-and-mongo_pk_reader">mongo_reader and mongo_pk_reader</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="tutorial_cell.html">pyg.base.cell</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial_perdictable.html">pyg.base.join</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial_timeseries.html">pyg.timeseries</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial_ts_decorators.html">pyg.timeseries decorators</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial_ts_ewma_time.html">pyg.timeseries.ewma</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="tutorial_dictable.html" title="previous chapter">pyg.base.dictable</a></li>
      <li>Next: <a href="tutorial_cell.html" title="next chapter">pyg.base.cell</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2021, Yoav Git.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.4.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/lab/tutorial_mongo.ipynb.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>