
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>pyg.mongo &#8212; pyg 0.0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="pyg.timeseries" href="timeseries.html" />
    <link rel="prev" title="pyg.base" href="base.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="pyg-mongo">
<h1>pyg.mongo<a class="headerlink" href="#pyg-mongo" title="Permalink to this headline">¶</a></h1>
<p>A few words on MongoDB, a no-SQL database versus SQL:</p>
<ul class="simple">
<li><p>Mongo has ‘collections’ that are the equivalent of tables</p></li>
<li><p>Mongo will refer to ‘documents’ instead of traditional records. Those records are unstructured and look like trees: dicts of dicts. They contain arbitary objects as well as just the primary types a SQL database is designed to support.</p></li>
<li><p>Mongo collections do not have the concept of primary keys</p></li>
<li><p>Mongo WHERE SQL clause is replaced by a query in a form of a dict “presented” to the collection object.</p></li>
<li><p>Mongo SELECT SQL clause is replaced by a ‘projection’ on the cursor, specifying what fields are retrieved.</p></li>
</ul>
<section id="query-generator">
<h2>Query generator<a class="headerlink" href="#query-generator" title="Permalink to this headline">¶</a></h2>
<p>We start by simplifying the way we generate mongo query dictionaries.</p>
<section id="q-and-q">
<h3>q and Q<a class="headerlink" href="#q-and-q" title="Permalink to this headline">¶</a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="pyg.mongo._q.Q">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">pyg.mongo._q.</span></span><span class="sig-name descname"><span class="pre">Q</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">keys</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyg.mongo._q.Q" title="Permalink to this definition">¶</a></dt>
<dd><p>The MongoDB interface for query of a collection (table) is via a creation of a complicated looking dict:
<a class="reference external" href="https://docs.mongodb.com/manual/tutorial/query-documents/">https://docs.mongodb.com/manual/tutorial/query-documents/</a></p>
<p>This is rather complicated for the average user so Q simplifies it greatly.
Q is based on TinyDB and users of TinyDB will recognise it. 
<a class="reference external" href="https://tinydb.readthedocs.io/en/latest/usage.html">https://tinydb.readthedocs.io/en/latest/usage.html</a></p>
<p>q is the singleton of Q.</p>
<p>q supports both <em>calling</em> to generate the querying dict</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">q</span><span class="p">(</span><span class="n">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p>or</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">a</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">b</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># {&quot;$and&quot;: [{&quot;a&quot;: {&quot;$eq&quot;: 1}}, {&quot;b&quot;: {&quot;$eq&quot;: 2}}]}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">a</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">b</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># {&quot;$or&quot;: [{&quot;a&quot;: {&quot;$eq&quot;: 1}}, {&quot;b&quot;: {&quot;$eq&quot;: 2}}]}</span>
</pre></div>
</div>
<p>or indeed</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">q</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">a</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="n">q</span><span class="o">.</span><span class="n">b</span>  <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Example</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyg</span> <span class="kn">import</span> <span class="n">q</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">re</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">dict</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">a</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="p">{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;$eq&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">dict</span><span class="p">(</span><span class="n">q</span><span class="p">(</span><span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]))</span> <span class="o">==</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;$in&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]}}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">dict</span><span class="p">(</span><span class="n">q</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">a</span> <span class="o">==</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="n">q</span><span class="o">.</span><span class="n">b</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">))</span> <span class="o">==</span> <span class="p">{</span><span class="s1">&#39;$and&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;$in&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]}},</span> <span class="p">{</span><span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;$gt&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">}}]}</span>  <span class="c1"># a in [1,2] and b greater than 3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">dict</span><span class="p">(</span><span class="n">q</span><span class="p">(</span><span class="n">a</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;^hello&#39;</span><span class="p">)))</span> <span class="o">==</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;regex&#39;</span><span class="p">:</span> <span class="s1">&#39;^hello&#39;</span><span class="p">}}</span>     <span class="c1"># a regex query using regex expressions    </span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">dict</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">exists</span> <span class="o">+</span> <span class="n">q</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="n">not_exists</span><span class="p">)</span>  <span class="o">==</span> <span class="p">{</span><span class="s2">&quot;$and&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;$exists&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">}},</span> <span class="p">{</span><span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;$exists&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">}}]}</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">dict</span><span class="p">(</span><span class="o">~</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">a</span><span class="o">==</span><span class="mi">1</span><span class="p">))</span>  <span class="o">==</span> <span class="p">{</span><span class="s1">&#39;$not&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;$eq&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}}}</span>
</pre></div>
</div>
</dd></dl>

</section>
</section>
<section id="tables-in-mongo">
<h2>Tables in Mongo<a class="headerlink" href="#tables-in-mongo" title="Permalink to this headline">¶</a></h2>
<section id="mongo-cursor">
<h3>mongo_cursor<a class="headerlink" href="#mongo-cursor" title="Permalink to this headline">¶</a></h3>
<p>mongo_cursor has hybrid functionality of a Mongo cursor and Mongo collection objects.</p>
<dl class="py class">
<dt class="sig sig-object py" id="pyg.mongo._cursor.mongo_cursor">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">pyg.mongo._cursor.</span></span><span class="sig-name descname"><span class="pre">mongo_cursor</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cursor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">writer</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reader</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">query</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">_</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyg.mongo._cursor.mongo_cursor" title="Permalink to this definition">¶</a></dt>
<dd><p>mongo_cursor is a souped-up combination of mongo.Cursor and mongo.Collection with a simple API.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<p>cursor : MongoDB cursor or MongoDB collection</p>
<dl>
<dt>writer<span class="classifier">True/False/string, optional</span></dt><dd><p>The default is None.</p>
<p>writer allows you to transform the data before saving it in Mongo. You can create a function yourself or use built-in options:</p>
<ul class="simple">
<li><p>False: do nothing, save the document as is</p></li>
<li><p>True/None: use pyg.base.encode to encode objects. This will transform numpy array/dataframes into bytes that can be stored</p></li>
<li><p>‘.csv’: save dataframes into csv files and then save reference of these files to mongo</p></li>
<li><p>‘.parquet’ save dataframes into .parquet and np.ndarray into .npy files.</p></li>
</ul>
<p>For .csv and .parquet to work, you will need to specify WHERE the document is to be saved. This can be done either:</p>
<ul class="simple">
<li><p>the document has a ‘root’ key, specifying the root.</p></li>
<li><p>you specify root by setting writer = ‘c:/%name%surname.parquet’</p></li>
</ul>
</dd>
<dt>reader<span class="classifier">callable or None, optional</span></dt><dd><p>The default is None, using decode. Use reader = False to passthru</p>
</dd>
<dt>query<span class="classifier">dict, optional</span></dt><dd><p>This is used to specify the Mongo query, e.g. q.a==1.</p>
</dd>
</dl>
<p><a href="#id1"><span class="problematic" id="id2">**</span></a>_ :</p>
<dl class="field-list simple">
<dt class="field-odd">Example</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyg</span> <span class="kn">import</span> <span class="o">*</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cursor</span> <span class="o">=</span> <span class="n">mongo_table</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cursor</span><span class="o">.</span><span class="n">drop</span><span class="p">()</span>
</pre></div>
</div>
<p>## insert some data</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">table</span> <span class="o">=</span> <span class="n">dictable</span><span class="p">(</span><span class="n">a</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span> <span class="o">*</span> <span class="n">dictable</span><span class="p">(</span><span class="n">b</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cursor</span><span class="o">.</span><span class="n">insert_many</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cursor</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">c</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">a</span> <span class="o">*</span> <span class="n">b</span><span class="p">)</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Filtering</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">cursor</span><span class="p">)</span> <span class="o">==</span> <span class="mi">25</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">cursor</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">a</span> <span class="o">=</span> <span class="mi">3</span><span class="p">))</span> <span class="o">==</span> <span class="mi">5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">cursor</span><span class="o">.</span><span class="n">exc</span><span class="p">(</span><span class="n">a</span> <span class="o">=</span> <span class="mi">3</span><span class="p">))</span> <span class="o">==</span> <span class="mi">20</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">cursor</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">b</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">))</span> <span class="o">==</span> <span class="mi">6</span> <span class="c1">## can chain queries as well as use q to create complicated expressions</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Row access</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">cursor</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
<p>{‘_id’: ObjectId(‘603aec85cd15e2c090c07b87’), ‘a’: 0, ‘b’: 0}</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">cursor</span><span class="p">[::]</span> <span class="o">-</span> <span class="s1">&#39;_id&#39;</span> <span class="o">==</span> <span class="n">dictable</span><span class="p">(</span><span class="n">cursor</span><span class="p">)</span> <span class="o">-</span> <span class="s1">&#39;_id&#39;</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">dictable</span><span class="p">[</span><span class="mi">25</span> <span class="n">x</span> <span class="mi">3</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">|</span><span class="n">b</span><span class="o">|</span><span class="n">c</span> 
<span class="gp">&gt;&gt;&gt; </span><span class="mi">0</span><span class="o">|</span><span class="mi">0</span><span class="o">|</span><span class="mi">0</span> 
<span class="gp">&gt;&gt;&gt; </span><span class="mi">0</span><span class="o">|</span><span class="mi">1</span><span class="o">|</span><span class="mi">0</span> 
<span class="gp">&gt;&gt;&gt; </span><span class="mi">0</span><span class="o">|</span><span class="mi">2</span><span class="o">|</span><span class="mi">0</span> 
<span class="gp">&gt;&gt;&gt; </span><span class="o">..</span><span class="mf">.25</span> <span class="n">rows</span><span class="o">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="mi">4</span><span class="o">|</span><span class="mi">2</span><span class="o">|</span><span class="mi">8</span> 
<span class="gp">&gt;&gt;&gt; </span><span class="mi">4</span><span class="o">|</span><span class="mi">3</span><span class="o">|</span><span class="mi">12</span>
<span class="gp">&gt;&gt;&gt; </span><span class="mi">4</span><span class="o">|</span><span class="mi">4</span><span class="o">|</span><span class="mi">16</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Column access</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">cursor</span><span class="p">[[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">]]</span>  <span class="c1">## just columns &#39;a&#39; and &#39;b&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">del</span> <span class="n">cursor</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">]</span> <span class="c1">## delete all c</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cursor</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">c</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">a</span> <span class="o">*</span> <span class="n">b</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">cursor</span><span class="o">.</span><span class="n">find_one</span><span class="p">(</span><span class="n">a</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">c</span> <span class="o">==</span> <span class="mi">6</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Example</dt>
<dd class="field-odd"><p>root specification</p>
</dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyg</span> <span class="kn">import</span> <span class="o">*</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="n">mongo_table</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="n">writer</span> <span class="o">=</span> <span class="s1">&#39;c:/temp/%name/</span><span class="si">%s</span><span class="s1">urname.parquet&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span><span class="o">.</span><span class="n">drop</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;adam&#39;</span><span class="p">,</span> <span class="n">surname</span> <span class="o">=</span> <span class="s1">&#39;smith&#39;</span><span class="p">,</span> <span class="n">ts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span><span class="o">.</span><span class="n">insert_one</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">eq</span><span class="p">(</span><span class="n">pd_read_parquet</span><span class="p">(</span><span class="s1">&#39;c:/temp/adam/smith/ts.parquet&#39;</span><span class="p">),</span> <span class="n">doc</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">eq</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;ts&#39;</span><span class="p">],</span> <span class="n">doc</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;beth&#39;</span><span class="p">,</span> <span class="n">surname</span> <span class="o">=</span> <span class="s1">&#39;brown&#39;</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span><span class="o">.</span><span class="n">insert_one</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
</pre></div>
</div>
<p>Since mongo_cursor is too powerful, we also have a mongo_reader version which is read-only.</p>
<dl class="py method">
<dt class="sig sig-object py" id="pyg.mongo._cursor.mongo_cursor.delete_many">
<span class="sig-name descname"><span class="pre">delete_many</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#pyg.mongo._cursor.mongo_cursor.delete_many" title="Permalink to this definition">¶</a></dt>
<dd><p>Equivalent to drop: deletes all documents the cursor currently points to.</p>
<dl class="field-list simple">
<dt class="field-odd">Note</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<p>If you want to drop a subset of the data, then use c.find(criteria).delete_many()</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<p>itself</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyg.mongo._cursor.mongo_cursor.delete_one">
<span class="sig-name descname"><span class="pre">delete_one</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyg.mongo._cursor.mongo_cursor.delete_one" title="Permalink to this definition">¶</a></dt>
<dd><p>drops a specific record after verifying exactly one exists.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<p><a href="#id3"><span class="problematic" id="id4">*</span></a>args : query
<a href="#id5"><span class="problematic" id="id6">**</span></a>kwargs : query</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<p>itself</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyg.mongo._cursor.mongo_cursor.drop">
<span class="sig-name descname"><span class="pre">drop</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#pyg.mongo._cursor.mongo_cursor.drop" title="Permalink to this definition">¶</a></dt>
<dd><p>Equivalent to drop: deletes all documents the cursor currently points to.</p>
<dl class="field-list simple">
<dt class="field-odd">Note</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<p>If you want to drop a subset of the data, then use c.find(criteria).delete_many()</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<p>itself</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyg.mongo._cursor.mongo_cursor.insert_many">
<span class="sig-name descname"><span class="pre">insert_many</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">table</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyg.mongo._cursor.mongo_cursor.insert_many" title="Permalink to this definition">¶</a></dt>
<dd><p>inserts multiple documents into the collection</p>
<dl class="simple">
<dt>table<span class="classifier">sequence of documents</span></dt><dd><p>list of dicts or dictable</p>
</dd>
</dl>
<p>mongo_cursor</p>
<dl class="field-list simple">
<dt class="field-odd">Example</dt>
<dd class="field-odd"><p>simple insertion</p>
</dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyg</span> <span class="kn">import</span> <span class="o">*</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="n">mongo_table</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">drop</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">values</span> <span class="o">=</span> <span class="n">dictable</span><span class="p">(</span><span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,],</span> <span class="n">b</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">insert_many</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span><span class="p">[::]</span>        
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">dictable</span><span class="p">[</span><span class="mi">4</span> <span class="n">x</span> <span class="mi">3</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">_id</span>                     <span class="o">|</span><span class="n">a</span><span class="o">|</span><span class="n">b</span>
<span class="gp">&gt;&gt;&gt; </span><span class="mi">602</span><span class="n">daee68c336f6429a77bdd</span><span class="o">|</span><span class="mi">1</span><span class="o">|</span><span class="mi">5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="mi">602</span><span class="n">daee68c336f6429a77bde</span><span class="o">|</span><span class="mi">2</span><span class="o">|</span><span class="mi">6</span>
<span class="gp">&gt;&gt;&gt; </span><span class="mi">602</span><span class="n">daee68c336f6429a77bdf</span><span class="o">|</span><span class="mi">3</span><span class="o">|</span><span class="mi">7</span>
<span class="gp">&gt;&gt;&gt; </span><span class="mi">602</span><span class="n">daee68c336f6429a77be0</span><span class="o">|</span><span class="mi">4</span><span class="o">|</span><span class="mi">8</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Example</dt>
<dd class="field-odd"><p>update</p>
</dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">table</span> <span class="o">=</span> <span class="n">t</span><span class="p">[::]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">modified</span> <span class="o">=</span> <span class="n">table</span><span class="p">(</span><span class="n">b</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">b</span><span class="p">:</span> <span class="n">b</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">insert_many</span><span class="p">(</span><span class="n">modified</span><span class="p">)</span>
</pre></div>
</div>
<p>Since each of the documents we uploaded already has an _id…</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span><span class="p">[::]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dictable</span><span class="p">[</span><span class="mi">4</span> <span class="n">x</span> <span class="mi">3</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">_id</span>                     <span class="o">|</span><span class="n">a</span><span class="o">|</span><span class="n">b</span>
<span class="gp">&gt;&gt;&gt; </span><span class="mi">602</span><span class="n">daee68c336f6429a77bdd</span><span class="o">|</span><span class="mi">1</span><span class="o">|</span><span class="mi">25</span>
<span class="gp">&gt;&gt;&gt; </span><span class="mi">602</span><span class="n">daee68c336f6429a77bde</span><span class="o">|</span><span class="mi">2</span><span class="o">|</span><span class="mi">36</span>
<span class="gp">&gt;&gt;&gt; </span><span class="mi">602</span><span class="n">daee68c336f6429a77bdf</span><span class="o">|</span><span class="mi">3</span><span class="o">|</span><span class="mi">49</span>
<span class="gp">&gt;&gt;&gt; </span><span class="mi">602</span><span class="n">daee68c336f6429a77be0</span><span class="o">|</span><span class="mi">4</span><span class="o">|</span><span class="mi">64</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyg.mongo._cursor.mongo_cursor.insert_one">
<span class="sig-name descname"><span class="pre">insert_one</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">doc</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyg.mongo._cursor.mongo_cursor.insert_one" title="Permalink to this definition">¶</a></dt>
<dd><p>inserts/updates a single document.</p>
<p>If the document ALREADY has _id in it, it updates that document
If the document has no _id in it, it inserts it as a new document</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<dl class="simple">
<dt>doc<span class="classifier">dict</span></dt><dd><p>document.</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Example</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyg</span> <span class="kn">import</span> <span class="o">*</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="n">mongo_table</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">drop</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">values</span> <span class="o">=</span> <span class="n">dictable</span><span class="p">(</span><span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,],</span> <span class="n">b</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">insert_many</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Example</dt>
<dd class="field-odd"><p>used to update an existing document</p>
</dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">8</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">str</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s2">&quot;{&#39;_id&#39;: ObjectId(&#39;602d36150a5cd32717323197&#39;), &#39;a&#39;: 1, &#39;b&#39;: 5, &#39;c&#39;: 8}&quot;</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">insert_one</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span>        
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">doc</span>        
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Example</dt>
<dd class="field-odd"><p>used to insert</p>
</dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">(</span><span class="n">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">insert_one</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">==</span> <span class="mi">5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span><span class="o">.</span><span class="n">drop</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="pyg.mongo._cursor.mongo_cursor.raw">
<em class="property"><span class="pre">property</span> </em><span class="sig-name descname"><span class="pre">raw</span></span><a class="headerlink" href="#pyg.mongo._cursor.mongo_cursor.raw" title="Permalink to this definition">¶</a></dt>
<dd><p>returns an unfiltered mongo_reader</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyg.mongo._cursor.mongo_cursor.set">
<span class="sig-name descname"><span class="pre">set</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyg.mongo._cursor.mongo_cursor.set" title="Permalink to this definition">¶</a></dt>
<dd><p>updates all documents in current cursor based on the kwargs. 
It is similar to update_many but supports also functions</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<p>kwargs: dict of values to be updated</p>
<dl class="field-list simple">
<dt class="field-odd">Example</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyg</span> <span class="kn">import</span> <span class="o">*</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="n">mongo_table</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">drop</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">values</span> <span class="o">=</span> <span class="n">dictable</span><span class="p">(</span><span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,],</span> <span class="n">b</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">insert_many</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">t</span><span class="p">[::]</span><span class="o">-</span><span class="s1">&#39;_id&#39;</span> <span class="o">==</span> <span class="n">values</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">t</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">c</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">t</span><span class="p">[::]</span><span class="o">-</span><span class="s1">&#39;_id&#39;</span> <span class="o">==</span> <span class="n">values</span><span class="p">(</span><span class="n">c</span> <span class="o">=</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">12</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">d</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">t</span><span class="p">[::]</span><span class="o">-</span><span class="s1">&#39;_id&#39;</span> <span class="o">==</span> <span class="n">values</span><span class="p">(</span><span class="n">c</span> <span class="o">=</span><span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="p">)(</span><span class="n">d</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<p>itself</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyg.mongo._cursor.mongo_cursor.update_many">
<span class="sig-name descname"><span class="pre">update_many</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">doc</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">upsert</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyg.mongo._cursor.mongo_cursor.update_many" title="Permalink to this definition">¶</a></dt>
<dd><p>updates all documents in current cursor based on the doc. The two are equivalent:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">cursot</span><span class="o">.</span><span class="n">update_many</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">collection</span><span class="o">.</span><span class="n">update_many</span><span class="p">(</span><span class="n">cursor</span><span class="o">.</span><span class="n">spec</span><span class="p">,</span> <span class="p">{</span> <span class="s1">&#39;set&#39;</span> <span class="p">:</span> <span class="n">update</span><span class="p">})</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<p>doc : dict of values to be updated</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<p>itself</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyg.mongo._cursor.mongo_cursor.update_one">
<span class="sig-name descname"><span class="pre">update_one</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">doc</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">upsert</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyg.mongo._cursor.mongo_cursor.update_one" title="Permalink to this definition">¶</a></dt>
<dd><ul class="simple">
<li><p>updates a document if an _id is present in doc.</p></li>
<li><p>insert a document if an _id is not present and upsert is true</p></li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<dl class="simple">
<dt>doc<span class="classifier">document</span></dt><dd><p>doc to be upserted.</p>
</dd>
<dt>upsert<span class="classifier">bool, optional</span></dt><dd><p>insert if no document present? The default is True.</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<dl class="simple">
<dt>doc</dt><dd><p>document updated.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
<section id="mongo-reader">
<h3>mongo_reader<a class="headerlink" href="#mongo-reader" title="Permalink to this headline">¶</a></h3>
<p>mongo_reader is a read-only version of the cursor to avoid any unintentional damage to database.</p>
<dl class="py class">
<dt class="sig sig-object py" id="pyg.mongo._reader.mongo_reader">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">pyg.mongo._reader.</span></span><span class="sig-name descname"><span class="pre">mongo_reader</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cursor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">writer</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reader</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">query</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">_</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyg.mongo._reader.mongo_reader" title="Permalink to this definition">¶</a></dt>
<dd><p>mongo_reader is a read-only version of the mongo_cursor. 
You can instantiate it with a mongo_reader(cursor) call where cursor can be a mongo_cursor, a pymongo.Cursor or a pymongo.Collection</p>
<dl class="py property">
<dt class="sig sig-object py" id="pyg.mongo._reader.mongo_reader.address">
<em class="property"><span class="pre">property</span> </em><span class="sig-name descname"><span class="pre">address</span></span><a class="headerlink" href="#pyg.mongo._reader.mongo_reader.address" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<dl class="simple">
<dt>tuple</dt><dd><p>A unique combination of the client addres, database name and collection name, identifying the collection uniquely.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyg.mongo._reader.mongo_reader.clone">
<span class="sig-name descname"><span class="pre">clone</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">params</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyg.mongo._reader.mongo_reader.clone" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<dl class="simple">
<dt>mongo_reader</dt><dd><p>Returns a cloned version of current mongo_reader but allows additional parameters to be set (see spec and project)</p>
</dd>
</dl>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="pyg.mongo._reader.mongo_reader.collection">
<em class="property"><span class="pre">property</span> </em><span class="sig-name descname"><span class="pre">collection</span></span><a class="headerlink" href="#pyg.mongo._reader.mongo_reader.collection" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<p>pymongo.Collection object</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyg.mongo._reader.mongo_reader.count">
<span class="sig-name descname"><span class="pre">count</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#pyg.mongo._reader.mongo_reader.count" title="Permalink to this definition">¶</a></dt>
<dd><p>cursor.count() and len(cursor) are the same and return the number of documents matching current specification.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyg.mongo._reader.mongo_reader.distinct">
<span class="sig-name descname"><span class="pre">distinct</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">key</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyg.mongo._reader.mongo_reader.distinct" title="Permalink to this definition">¶</a></dt>
<dd><p>returns the distinct values of the key</p>
<dl class="simple">
<dt>key<span class="classifier">str</span></dt><dd><p>a key in the documents.</p>
</dd>
</dl>
<dl class="simple">
<dt>list of strings</dt><dd><p>distinct values</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Example</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyg</span> <span class="kn">import</span> <span class="o">*</span><span class="p">;</span> <span class="kn">import</span> <span class="nn">pymongo</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">table</span> <span class="o">=</span> <span class="n">pymongo</span><span class="o">.</span><span class="n">MongoClient</span><span class="p">()[</span><span class="s1">&#39;test&#39;</span><span class="p">][</span><span class="s1">&#39;test&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">table</span><span class="o">.</span><span class="n">insert_one</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;alan&#39;</span><span class="p">,</span> <span class="n">surname</span> <span class="o">=</span> <span class="s1">&#39;abrahams&#39;</span><span class="p">,</span> <span class="n">age</span> <span class="o">=</span> <span class="mi">39</span><span class="p">,</span> <span class="n">marriage</span> <span class="o">=</span> <span class="n">dt</span><span class="p">(</span><span class="mi">2000</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">table</span><span class="o">.</span><span class="n">insert_one</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;barbara&#39;</span><span class="p">,</span> <span class="n">surname</span> <span class="o">=</span> <span class="s1">&#39;brown&#39;</span><span class="p">,</span> <span class="n">age</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span> <span class="n">marriage</span> <span class="o">=</span> <span class="n">dt</span><span class="p">(</span><span class="mi">2020</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">table</span><span class="o">.</span><span class="n">insert_one</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;charlie&#39;</span><span class="p">,</span> <span class="n">surname</span> <span class="o">=</span> <span class="s1">&#39;cohen&#39;</span><span class="p">,</span> <span class="n">age</span> <span class="o">=</span> <span class="mi">20</span><span class="p">))</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="n">mongo_reader</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">t</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">t</span><span class="o">.</span><span class="n">distinct</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;alan&#39;</span><span class="p">,</span> <span class="s1">&#39;barbara&#39;</span><span class="p">,</span> <span class="s1">&#39;charlie&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">table</span><span class="o">.</span><span class="n">drop</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyg.mongo._reader.mongo_reader.docs">
<span class="sig-name descname"><span class="pre">docs</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">doc</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'doc'</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">keys</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyg.mongo._reader.mongo_reader.docs" title="Permalink to this definition">¶</a></dt>
<dd><p>self[::] flattens the entire document.
At times, we want to see the full documents, indexed by keys and docs does that.        
returns a dictable with both keys and the document in the ‘doc’ column</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyg.mongo._reader.mongo_reader.exc">
<span class="sig-name descname"><span class="pre">exc</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyg.mongo._reader.mongo_reader.exc" title="Permalink to this definition">¶</a></dt>
<dd><p>filters ‘negatively’ removing documents that match the criteria specified.</p>
<dl class="simple">
<dt>cursor</dt><dd><p>filtered documents.</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Example</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyg</span> <span class="kn">import</span> <span class="o">*</span><span class="p">;</span> <span class="kn">import</span> <span class="nn">pymongo</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">table</span> <span class="o">=</span> <span class="n">pymongo</span><span class="o">.</span><span class="n">MongoClient</span><span class="p">()[</span><span class="s1">&#39;test&#39;</span><span class="p">][</span><span class="s1">&#39;test&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">table</span><span class="o">.</span><span class="n">insert_one</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;alan&#39;</span><span class="p">,</span> <span class="n">surname</span> <span class="o">=</span> <span class="s1">&#39;abrahams&#39;</span><span class="p">,</span> <span class="n">age</span> <span class="o">=</span> <span class="mi">39</span><span class="p">,</span> <span class="n">marriage</span> <span class="o">=</span> <span class="n">dt</span><span class="p">(</span><span class="mi">2000</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">table</span><span class="o">.</span><span class="n">insert_one</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;barbara&#39;</span><span class="p">,</span> <span class="n">surname</span> <span class="o">=</span> <span class="s1">&#39;brown&#39;</span><span class="p">,</span> <span class="n">age</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span> <span class="n">marriage</span> <span class="o">=</span> <span class="n">dt</span><span class="p">(</span><span class="mi">2020</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">table</span><span class="o">.</span><span class="n">insert_one</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;charlie&#39;</span><span class="p">,</span> <span class="n">surname</span> <span class="o">=</span> <span class="s1">&#39;cohen&#39;</span><span class="p">,</span> <span class="n">age</span> <span class="o">=</span> <span class="mi">20</span><span class="p">))</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="n">mongo_reader</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">exc</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;alan&#39;</span><span class="p">))</span> <span class="o">==</span> <span class="mi">2</span>        
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">exc</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;alan&#39;</span><span class="p">,</span> <span class="s1">&#39;barbara&#39;</span><span class="p">]))</span> <span class="o">==</span> <span class="mi">1</span>        
<span class="gp">&gt;&gt;&gt; </span><span class="n">table</span><span class="o">.</span><span class="n">drop</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyg.mongo._reader.mongo_reader.find">
<span class="sig-name descname"><span class="pre">find</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyg.mongo._reader.mongo_reader.find" title="Permalink to this definition">¶</a></dt>
<dd><p>Same as self.specify()</p>
<p>The ‘spec’ is the cursor’s filter on documents (can think of it as row-selection) within the collection.
We use q (see pyg.mongo._q.q) to specify the filter on the cursor.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<p>A filtered mongo_reader cursor</p>
<dl class="field-list simple">
<dt class="field-odd">Example</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyg</span> <span class="kn">import</span> <span class="o">*</span><span class="p">;</span> <span class="kn">import</span> <span class="nn">pymongo</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">table</span> <span class="o">=</span> <span class="n">pymongo</span><span class="o">.</span><span class="n">MongoClient</span><span class="p">()[</span><span class="s1">&#39;test&#39;</span><span class="p">][</span><span class="s1">&#39;test&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">table</span><span class="o">.</span><span class="n">insert_one</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;alan&#39;</span><span class="p">,</span> <span class="n">surname</span> <span class="o">=</span> <span class="s1">&#39;abrahams&#39;</span><span class="p">,</span> <span class="n">age</span> <span class="o">=</span> <span class="mi">39</span><span class="p">,</span> <span class="n">marriage</span> <span class="o">=</span> <span class="n">dt</span><span class="p">(</span><span class="mi">2000</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">table</span><span class="o">.</span><span class="n">insert_one</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;barbara&#39;</span><span class="p">,</span> <span class="n">surname</span> <span class="o">=</span> <span class="s1">&#39;brown&#39;</span><span class="p">,</span> <span class="n">age</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span> <span class="n">marriage</span> <span class="o">=</span> <span class="n">dt</span><span class="p">(</span><span class="mi">2020</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">table</span><span class="o">.</span><span class="n">insert_one</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;charlie&#39;</span><span class="p">,</span> <span class="n">surname</span> <span class="o">=</span> <span class="s1">&#39;cohen&#39;</span><span class="p">,</span> <span class="n">age</span> <span class="o">=</span> <span class="mi">20</span><span class="p">))</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="n">mongo_reader</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;alan&#39;</span><span class="p">))</span> <span class="o">==</span> <span class="mi">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">age</span><span class="o">&gt;</span><span class="mi">25</span><span class="p">))</span> <span class="o">==</span> <span class="mi">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">age</span><span class="o">&gt;</span><span class="mi">25</span><span class="p">,</span> <span class="n">q</span><span class="o">.</span><span class="n">marriage</span><span class="o">&lt;</span><span class="n">dt</span><span class="p">(</span><span class="mi">2010</span><span class="p">)))</span> <span class="o">==</span> <span class="mi">1</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">table</span><span class="o">.</span><span class="n">drop</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyg.mongo._reader.mongo_reader.find_one">
<span class="sig-name descname"><span class="pre">find_one</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">doc</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyg.mongo._reader.mongo_reader.find_one" title="Permalink to this definition">¶</a></dt>
<dd><p>searches for records based either on the doc, or the args/kwargs specified.
Unlike mongo cursor which finds one of many, here, when we ask for find_one, we will throw an exception if more than one documents are found.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<blockquote>
<div><p>A cursor pointing to a single record (document)</p>
</div></blockquote>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyg.mongo._reader.mongo_reader.inc">
<span class="sig-name descname"><span class="pre">inc</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyg.mongo._reader.mongo_reader.inc" title="Permalink to this definition">¶</a></dt>
<dd><p>Same as self.specify()</p>
<p>The ‘spec’ is the cursor’s filter on documents (can think of it as row-selection) within the collection.
We use q (see pyg.mongo._q.q) to specify the filter on the cursor.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<p>A filtered mongo_reader cursor</p>
<dl class="field-list simple">
<dt class="field-odd">Example</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyg</span> <span class="kn">import</span> <span class="o">*</span><span class="p">;</span> <span class="kn">import</span> <span class="nn">pymongo</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">table</span> <span class="o">=</span> <span class="n">pymongo</span><span class="o">.</span><span class="n">MongoClient</span><span class="p">()[</span><span class="s1">&#39;test&#39;</span><span class="p">][</span><span class="s1">&#39;test&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">table</span><span class="o">.</span><span class="n">insert_one</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;alan&#39;</span><span class="p">,</span> <span class="n">surname</span> <span class="o">=</span> <span class="s1">&#39;abrahams&#39;</span><span class="p">,</span> <span class="n">age</span> <span class="o">=</span> <span class="mi">39</span><span class="p">,</span> <span class="n">marriage</span> <span class="o">=</span> <span class="n">dt</span><span class="p">(</span><span class="mi">2000</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">table</span><span class="o">.</span><span class="n">insert_one</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;barbara&#39;</span><span class="p">,</span> <span class="n">surname</span> <span class="o">=</span> <span class="s1">&#39;brown&#39;</span><span class="p">,</span> <span class="n">age</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span> <span class="n">marriage</span> <span class="o">=</span> <span class="n">dt</span><span class="p">(</span><span class="mi">2020</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">table</span><span class="o">.</span><span class="n">insert_one</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;charlie&#39;</span><span class="p">,</span> <span class="n">surname</span> <span class="o">=</span> <span class="s1">&#39;cohen&#39;</span><span class="p">,</span> <span class="n">age</span> <span class="o">=</span> <span class="mi">20</span><span class="p">))</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="n">mongo_reader</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;alan&#39;</span><span class="p">))</span> <span class="o">==</span> <span class="mi">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">age</span><span class="o">&gt;</span><span class="mi">25</span><span class="p">))</span> <span class="o">==</span> <span class="mi">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">age</span><span class="o">&gt;</span><span class="mi">25</span><span class="p">,</span> <span class="n">q</span><span class="o">.</span><span class="n">marriage</span><span class="o">&lt;</span><span class="n">dt</span><span class="p">(</span><span class="mi">2010</span><span class="p">)))</span> <span class="o">==</span> <span class="mi">1</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">table</span><span class="o">.</span><span class="n">drop</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyg.mongo._reader.mongo_reader.project">
<span class="sig-name descname"><span class="pre">project</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">projection</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyg.mongo._reader.mongo_reader.project" title="Permalink to this definition">¶</a></dt>
<dd><p>The ‘projection’ is the cursor’s column selection on documents. If in SQL we write SELECT col1, col2 FROM …, in Mongo, the cursor.projection = [‘col1’, ‘col2’]</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<p>projection: a list/str of keys we are interested in reading. Note that nested keys are OK: ‘level1.level2.name’ is perfectly good</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<p>A mongo_reader cursor filtered to read just these keys</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="pyg.mongo._reader.mongo_reader.projection">
<em class="property"><span class="pre">property</span> </em><span class="sig-name descname"><span class="pre">projection</span></span><a class="headerlink" href="#pyg.mongo._reader.mongo_reader.projection" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<blockquote>
<div><p>The ‘projection’ is the cursor’s column selection on documents. If in SQL we write SELECT col1, col2 FROM …, in Mongo, the cursor.projection = [‘col1’, ‘col2’]</p>
</div></blockquote>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="pyg.mongo._reader.mongo_reader.raw">
<em class="property"><span class="pre">property</span> </em><span class="sig-name descname"><span class="pre">raw</span></span><a class="headerlink" href="#pyg.mongo._reader.mongo_reader.raw" title="Permalink to this definition">¶</a></dt>
<dd><p>returns an unfiltered mongo_reader</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyg.mongo._reader.mongo_reader.read">
<span class="sig-name descname"><span class="pre">read</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">item</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reader</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyg.mongo._reader.mongo_reader.read" title="Permalink to this definition">¶</a></dt>
<dd><p>reads the next document from the collection.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<dl class="simple">
<dt>item<span class="classifier">int, optional</span></dt><dd><p>Please read the ith record. The default is 0.</p>
</dd>
<dt>reader<span class="classifier">callable/list of callables, optional</span></dt><dd><p>When we read the document from the collection, we first transform them. 
The default behaviour is to use pyg.base._encode.decode but you may pass reader = False to grab the raw data from mongo</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<dl class="simple">
<dt>document</dt><dd><p>The document from Mongo</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyg.mongo._reader.mongo_reader.sort">
<span class="sig-name descname"><span class="pre">sort</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">by</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyg.mongo._reader.mongo_reader.sort" title="Permalink to this definition">¶</a></dt>
<dd><p>sorting on server side, per key(s)</p>
<p>by : str/list of strs</p>
<p>sorted cursor.</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="pyg.mongo._reader.mongo_reader.spec">
<em class="property"><span class="pre">property</span> </em><span class="sig-name descname"><span class="pre">spec</span></span><a class="headerlink" href="#pyg.mongo._reader.mongo_reader.spec" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<blockquote>
<div><p>The ‘spec’ is the cursor’s filter on documents (can think of it as row-selection) within the collection</p>
</div></blockquote>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyg.mongo._reader.mongo_reader.specify">
<span class="sig-name descname"><span class="pre">specify</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyg.mongo._reader.mongo_reader.specify" title="Permalink to this definition">¶</a></dt>
<dd><p>The ‘spec’ is the cursor’s filter on documents (can think of it as row-selection) within the collection.
We use q (see pyg.mongo._q.q) to specify the filter on the cursor.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<p>A filtered mongo_reader cursor</p>
</dd></dl>

</dd></dl>

</section>
<section id="mongo-pk-reader">
<h3>mongo_pk_reader<a class="headerlink" href="#mongo-pk-reader" title="Permalink to this headline">¶</a></h3>
<p>mongo_pk_reader extends the standard reader to handle tables with primary keys (pk) while being read-only.</p>
<dl class="py class">
<dt class="sig sig-object py" id="pyg.mongo._pk_reader.mongo_pk_reader">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">pyg.mongo._pk_reader.</span></span><span class="sig-name descname"><span class="pre">mongo_pk_reader</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cursor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pk</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">writer</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reader</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">query</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">_</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyg.mongo._pk_reader.mongo_pk_reader" title="Permalink to this definition">¶</a></dt>
<dd><p>we set up a system in Mongo to ensure we can mimin tables with primary keys. 
The way we do this is two folds:</p>
<blockquote>
<div><ul class="simple">
<li><p>At document insertion, we mark as _deleted old documents sharing the same keys by adding a key _deleted to the old doc</p></li>
<li><p>At reading, we filter for documents where q._deleted.not_exists.</p></li>
</ul>
</div></blockquote>
<dl class="py method">
<dt class="sig sig-object py" id="pyg.mongo._pk_reader.mongo_pk_reader.clone">
<span class="sig-name descname"><span class="pre">clone</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyg.mongo._pk_reader.mongo_pk_reader.clone" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<dl class="simple">
<dt>mongo_reader</dt><dd><p>Returns a cloned version of current mongo_reader but allows additional parameters to be set (see spec and project)</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyg.mongo._pk_reader.mongo_pk_reader.create_index">
<span class="sig-name descname"><span class="pre">create_index</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">keys</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyg.mongo._pk_reader.mongo_pk_reader.create_index" title="Permalink to this definition">¶</a></dt>
<dd><p>creates a sorted index on the collection</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<dl class="simple">
<dt><a href="#id7"><span class="problematic" id="id8">*</span></a>keys<span class="classifier">strings</span></dt><dd><p>if misssing, use the primary keys.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyg.mongo._pk_reader.mongo_pk_reader.dedup">
<span class="sig-name descname"><span class="pre">dedup</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#pyg.mongo._pk_reader.mongo_pk_reader.dedup" title="Permalink to this definition">¶</a></dt>
<dd><p>Although in principle, if a single process reads/writes to Mongo, we should not get duplicates. 
In practice, when multiple clients access the database, we occasionally get multiple records with the same primary keys.
When this happens, we also end up with poor mongo _ids</p>
<dl class="simple">
<dt>mongo_pk_cursor</dt><dd><p>Hopefully, a table with unique keys.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyg.mongo._pk_reader.mongo_pk_reader.docs">
<span class="sig-name descname"><span class="pre">docs</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">doc</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'doc'</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">keys</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyg.mongo._pk_reader.mongo_pk_reader.docs" title="Permalink to this definition">¶</a></dt>
<dd><p>self[::] flattens the entire document.
At times, we want to see the full documents, indexed by keys and docs does that.        
returns a dictable with both keys and the document in the ‘doc’ column</p>
</dd></dl>

</dd></dl>

</section>
<section id="mongo-pk-cursor">
<h3>mongo_pk_cursor<a class="headerlink" href="#mongo-pk-cursor" title="Permalink to this headline">¶</a></h3>
<p>mongo_pk_cursor is our go-to object and it manages all our primary-keyed tables.
.. autoclass:: pyg.mongo._pk_cursor.mongo_pk_cursor</p>
<blockquote>
<div><dl class="field-list simple">
<dt class="field-odd">members</dt>
<dd class="field-odd"><p></p></dd>
</dl>
</div></blockquote>
</section>
</section>
<section id="encoding-docs-before-saving-to-mongo">
<h2>encoding docs before saving to mongo<a class="headerlink" href="#encoding-docs-before-saving-to-mongo" title="Permalink to this headline">¶</a></h2>
<p>Before we save data to Mongo, we may need to transform it, especially if we are to save pd.DataFrame. By default, we encode them into bytes and push to mongo.
You can choose to save pandas dataframes/series as .parquet files and numpy arrays into .npy files.</p>
<section id="parquet-write">
<h3>parquet_write<a class="headerlink" href="#parquet-write" title="Permalink to this headline">¶</a></h3>
<dl class="py function">
<dt class="sig sig-object py" id="pyg.mongo._encoders.parquet_write">
<span class="sig-prename descclassname"><span class="pre">pyg.mongo._encoders.</span></span><span class="sig-name descname"><span class="pre">parquet_write</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">doc</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">root</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyg.mongo._encoders.parquet_write" title="Permalink to this definition">¶</a></dt>
<dd><p>MongoDB is great for manipulating/searching dict keys/values. 
However, the actual dataframes in each doc, we may want to save in a file system. 
- The DataFrames are stored as bytes in MongoDB anyway, so they are not searchable
- Storing in files allows other non-python/non-MongoDB users easier access, allowing data to be detached from app
- MongoDB free version has limitations on size of document
- file based system may be faster, especially if saved locally not over network
- for data licensing issues, data must not sit on servers but stored on local computer</p>
<p>Therefore, the doc encode will cycle through the elements in the doc. Each time it sees a pd.DataFrame/pd.Series, it will 
- determine where to write it (with the help of the doc)
- save it to a .parquet file</p>
</dd></dl>

</section>
<section id="csv-write">
<h3>csv_write<a class="headerlink" href="#csv-write" title="Permalink to this headline">¶</a></h3>
<dl class="py function">
<dt class="sig sig-object py" id="pyg.mongo._encoders.csv_write">
<span class="sig-prename descclassname"><span class="pre">pyg.mongo._encoders.</span></span><span class="sig-name descname"><span class="pre">csv_write</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">doc</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">root</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyg.mongo._encoders.csv_write" title="Permalink to this definition">¶</a></dt>
<dd><p>MongoDB is great for manipulating/searching dict keys/values. 
However, the actual dataframes in each doc, we may want to save in a file system. 
- The DataFrames are stored as bytes in MongoDB anyway, so they are not searchable
- Storing in files allows other non-python/non-MongoDB users easier access, allowing data to be detached from orignal application
- MongoDB free version has limitations on size of document
- file based system may be faster, especially if saved locally not over network
- for data licensing issues, data must not sit on servers but stored on local computer</p>
<p>Therefore, the doc encode will cycle through the elements in the doc. Each time it sees a pd.DataFrame/pd.Series, it will 
- determine where to write it (with the help of the doc)
- save it to a .csv file</p>
</dd></dl>

</section>
</section>
<section id="cells-in-mongo">
<h2>cells in Mongo<a class="headerlink" href="#cells-in-mongo" title="Permalink to this headline">¶</a></h2>
<p>Now that we have a database, we construct cells that can load/save data to collections.</p>
<section id="db-cell">
<h3>db_cell<a class="headerlink" href="#db-cell" title="Permalink to this headline">¶</a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="pyg.mongo._db_cell.db_cell">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">pyg.mongo._db_cell.</span></span><span class="sig-name descname"><span class="pre">db_cell</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">function</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">output</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">db</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyg.mongo._db_cell.db_cell" title="Permalink to this definition">¶</a></dt>
<dd><p>a db_cell is a specialized cell with a ‘db’ member pointing to a database where cell is to be stored.    
We use this to implement save/load for the cell.</p>
<p>It is important to recognize the duality in the design:
- the job of the cell.db is to be able to save/load based on the primary keys.
- the job of the cell is to provide the primary keys to the db object.</p>
<p>The cell saves itself by ‘presenting’ itself to cell.db() and say… go on, load my data based on my keys.</p>
<dl class="field-list simple">
<dt class="field-odd">Example</dt>
<dd class="field-odd"><p>saving &amp; loading</p>
</dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyg</span> <span class="kn">import</span> <span class="o">*</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">people</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">mongo_table</span><span class="p">,</span> <span class="n">db</span> <span class="o">=</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="n">table</span> <span class="o">=</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="n">pk</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;surname&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">anna</span> <span class="o">=</span> <span class="n">db_cell</span><span class="p">(</span><span class="n">db</span> <span class="o">=</span> <span class="n">people</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;anna&#39;</span><span class="p">,</span> <span class="n">surname</span> <span class="o">=</span> <span class="s1">&#39;abramzon&#39;</span><span class="p">,</span> <span class="n">age</span> <span class="o">=</span> <span class="mi">46</span><span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bob</span>  <span class="o">=</span> <span class="n">db_cell</span><span class="p">(</span><span class="n">db</span> <span class="o">=</span> <span class="n">people</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;bob&#39;</span><span class="p">,</span> <span class="n">surname</span> <span class="o">=</span> <span class="s1">&#39;brown&#39;</span><span class="p">,</span> <span class="n">age</span> <span class="o">=</span> <span class="mi">25</span><span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">james</span> <span class="o">=</span> <span class="n">db_cell</span><span class="p">(</span><span class="n">db</span> <span class="o">=</span> <span class="n">people</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;james&#39;</span><span class="p">,</span> <span class="n">surname</span> <span class="o">=</span> <span class="s1">&#39;johnson&#39;</span><span class="p">,</span> <span class="n">age</span> <span class="o">=</span> <span class="mi">39</span><span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
<p>Now we can pull the data directly from the database</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">people</span><span class="p">()[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;surname&#39;</span><span class="p">,</span> <span class="s1">&#39;age&#39;</span><span class="p">][::]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dictable</span><span class="p">[</span><span class="mi">3</span> <span class="n">x</span> <span class="mi">4</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">_id</span>                     <span class="o">|</span><span class="n">age</span><span class="o">|</span><span class="n">name</span> <span class="o">|</span><span class="n">surname</span> 
<span class="gp">&gt;&gt;&gt; </span><span class="mf">601e732</span><span class="n">e0ef13bec9cd8a6cb</span><span class="o">|</span><span class="mi">39</span> <span class="o">|</span><span class="n">james</span><span class="o">|</span><span class="n">johnson</span> 
<span class="gp">&gt;&gt;&gt; </span><span class="mf">601e73</span><span class="n">db0ef13bec9cd8a6d4</span><span class="o">|</span><span class="mi">46</span> <span class="o">|</span><span class="n">anna</span> <span class="o">|</span><span class="n">abramzon</span>
<span class="gp">&gt;&gt;&gt; </span><span class="mf">601e73</span><span class="n">db0ef13bec9cd8a6d7</span><span class="o">|</span><span class="mi">25</span> <span class="o">|</span><span class="n">bob</span>  <span class="o">|</span><span class="n">brown</span>       
</pre></div>
</div>
<p>db_cell can implement a function:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">is_young</span><span class="p">(</span><span class="n">age</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>   <span class="k">return</span> <span class="n">age</span> <span class="o">&lt;</span> <span class="mi">30</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bob</span><span class="o">.</span><span class="n">function</span> <span class="o">=</span> <span class="n">is_young</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bob</span> <span class="o">=</span> <span class="n">bob</span><span class="o">.</span><span class="n">go</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">bob</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="kc">True</span>
</pre></div>
</div>
<p>When run, it saves its new data to Mongo and we can load its own data:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">new_cell_with_just_db_and_keys</span> <span class="o">=</span> <span class="n">db_cell</span><span class="p">(</span><span class="n">db</span> <span class="o">=</span> <span class="n">people</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;bob&#39;</span><span class="p">,</span> <span class="n">surname</span> <span class="o">=</span> <span class="s1">&#39;brown&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="s1">&#39;age&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">new_cell_with_just_db_and_keys</span> 
<span class="gp">&gt;&gt;&gt; </span><span class="n">now_with_the_data_from_database</span> <span class="o">=</span> <span class="n">new_cell_with_just_db_and_keys</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">now_with_the_data_from_database</span><span class="o">.</span><span class="n">age</span> <span class="o">==</span> <span class="mi">25</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">people</span><span class="p">()[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;surname&#39;</span><span class="p">,</span> <span class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">][::]</span>
<span class="gp">&gt;&gt;&gt; </span> <span class="n">dictable</span><span class="p">[</span><span class="mi">3</span> <span class="n">x</span> <span class="mi">4</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">_id</span>                     <span class="o">|</span><span class="n">age</span><span class="o">|</span><span class="n">name</span> <span class="o">|</span><span class="n">surname</span> <span class="o">|</span><span class="n">data</span>
<span class="gp">&gt;&gt;&gt; </span><span class="mf">601e732</span><span class="n">e0ef13bec9cd8a6cb</span><span class="o">|</span><span class="mi">39</span> <span class="o">|</span><span class="n">james</span><span class="o">|</span><span class="n">johnson</span> <span class="o">|</span><span class="kc">None</span>
<span class="gp">&gt;&gt;&gt; </span><span class="mf">601e73</span><span class="n">db0ef13bec9cd8a6d4</span><span class="o">|</span><span class="mi">46</span> <span class="o">|</span><span class="n">anna</span> <span class="o">|</span><span class="n">abramzon</span><span class="o">|</span><span class="kc">None</span>
<span class="gp">&gt;&gt;&gt; </span><span class="mf">601e73</span><span class="n">db0ef13bec9cd8a6d7</span><span class="o">|</span><span class="mi">25</span> <span class="o">|</span><span class="n">bob</span>  <span class="o">|</span><span class="n">brown</span>   <span class="o">|</span><span class="kc">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">people</span><span class="p">()</span><span class="o">.</span><span class="n">raw</span><span class="o">.</span><span class="n">drop</span><span class="p">()</span>    
</pre></div>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="pyg.mongo._db_cell.db_cell.go">
<span class="sig-name descname"><span class="pre">go</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">go</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mode</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyg.mongo._db_cell.db_cell.go" title="Permalink to this definition">¶</a></dt>
<dd><p>calculates the cell (if needed). By default, will then run cell.save() to save the cell. 
If you don’t want to save the output (perhaps you want to check it first), use cell._go()</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<dl class="simple">
<dt>go<span class="classifier">int, optional</span></dt><dd><p>a parameter that forces calculation. The default is 0.
go = 0: calculate cell only if cell.run() is True
go = 1: calculate THIS cell regardless. calculate the parents only if their cell.run() is True
go = 2: calculate THIS cell and PARENTS cell regardless, calculate grandparents if cell.run() is True etc.
go = -1: calculate the entire tree again.</p>
</dd>
<dt><a href="#id9"><span class="problematic" id="id10">**</span></a>kwargs<span class="classifier">parameters</span></dt><dd><p>You can actually allocate the variables to the function at runtime</p>
</dd>
</dl>
<p>Note that by default, cell.go() will default to go = 1 and force a calculation on cell while cell() is lazy and will default to assuming go = 0</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<dl class="simple">
<dt>cell</dt><dd><p>the cell, calculated</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Example</dt>
<dd class="field-odd"><p>different values of go</p>
</dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyg</span> <span class="kn">import</span> <span class="o">*</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">:</span> <span class="nb">max</span><span class="p">([</span><span class="n">dt</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">dt</span><span class="p">(</span><span class="n">y</span><span class="p">)])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">cell</span><span class="p">(</span><span class="n">f</span><span class="p">)()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">cell</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">a</span><span class="p">)()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">cell</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">b</span><span class="p">)()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="n">cell</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">c</span><span class="p">)()</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">e</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">go</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">e0</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">go</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">e1</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">go</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">e2</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">go</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">e_1</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">go</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="ow">not</span> <span class="n">d</span><span class="o">.</span><span class="n">run</span><span class="p">()</span> <span class="ow">and</span> <span class="n">e</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="n">d</span><span class="o">.</span><span class="n">data</span> 
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">e0</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="n">d</span><span class="o">.</span><span class="n">data</span> 
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">e1</span><span class="o">.</span><span class="n">data</span> <span class="o">&gt;</span> <span class="n">d</span><span class="o">.</span><span class="n">data</span> <span class="ow">and</span> <span class="n">e1</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="n">d</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">data</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">e2</span><span class="o">.</span><span class="n">data</span> <span class="o">&gt;</span> <span class="n">d</span><span class="o">.</span><span class="n">data</span> <span class="ow">and</span> <span class="n">e2</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">data</span> <span class="o">&gt;</span> <span class="n">d</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">data</span> <span class="ow">and</span> <span class="n">e2</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="n">d</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">data</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">e_1</span><span class="o">.</span><span class="n">data</span> <span class="o">&gt;</span> <span class="n">d</span><span class="o">.</span><span class="n">data</span> <span class="ow">and</span> <span class="n">e_1</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">data</span> <span class="o">&gt;</span> <span class="n">d</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">data</span> <span class="ow">and</span> <span class="n">e_1</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">data</span> <span class="o">&gt;</span> <span class="n">d</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">data</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Example</dt>
<dd class="field-odd"><p>adding parameters on the run</p>
</dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">cell</span><span class="p">(</span><span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="n">c</span><span class="p">(</span><span class="n">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">d</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="mi">3</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyg.mongo._db_cell.db_cell.load">
<span class="sig-name descname"><span class="pre">load</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mode</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyg.mongo._db_cell.db_cell.load" title="Permalink to this definition">¶</a></dt>
<dd><p>loads a document from the database and updates various keys.</p>
<dl class="field-list simple">
<dt class="field-odd">Persistency</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<p>Since we want to avoid hitting the database, there is a singleton GRAPH, a dict, storing the cells by their address.
Every time we load/save from/to Mongo, we also update GRAPH.</p>
<p>We use the GRAPH often so if you want to FORCE the cell to go to the database when loading, use this:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">cell</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> 
<span class="gp">&gt;&gt;&gt; </span><span class="n">cell</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># clear GRAPH and load from db</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cell</span><span class="o">.</span><span class="n">load</span><span class="p">([</span><span class="mi">0</span><span class="p">])</span>     <span class="c1"># same thing: clear GRAPH and then load if available</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Merge of cached cell and calling cell</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<p>Once we load from memory (either MongoDB or GRAPH), we tree_update the cached cell with the new values in the current cell.
This means that it is next to impossible to actually <em>delete</em> keys. If you want to delete keys in a cell/cells in the database, you need to:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">del</span> <span class="n">db</span><span class="o">.</span><span class="n">inc</span><span class="p">(</span><span class="n">filters</span><span class="p">)[</span><span class="s1">&#39;key.subkey&#39;</span><span class="p">]</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<dl>
<dt>mode<span class="classifier">int , dataetime, optional</span></dt><dd><p>if -1, then does not load and clears the GRAPH
if 0, then will load from database if found. If not found, will return original document
if 1, then will throw an exception if no document is found in the database
if mode is a date, will return the version alive at that date 
The default is 0.</p>
<p>IF you enclose any of these in a list, then GRAPH is cleared prior to running and the database is called.</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<p>document</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pyg.mongo._db_cell.db_cell.save">
<span class="sig-name descname"><span class="pre">save</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#pyg.mongo._db_cell.db_cell.save" title="Permalink to this definition">¶</a></dt>
<dd><p>Saves the cell for persistency. Not implemented for simple cell. see db_cell</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<dl class="simple">
<dt>cell</dt><dd><p>self, saved.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
<section id="periodic-cell">
<h3>periodic_cell<a class="headerlink" href="#periodic-cell" title="Permalink to this headline">¶</a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="pyg.mongo._periodic_cell.periodic_cell">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">pyg.mongo._periodic_cell.</span></span><span class="sig-name descname"><span class="pre">periodic_cell</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">function</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">output</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">db</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">period</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'1b'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">updated</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyg.mongo._periodic_cell.periodic_cell" title="Permalink to this definition">¶</a></dt>
<dd><p>periodic_cell inherits from db_cell its ability to save itself in MongoDb using its db members
Its calculation schedule depends on when it was last updated.</p>
<dl class="field-list simple">
<dt class="field-odd">Example</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyg</span> <span class="kn">import</span> <span class="o">*</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">periodic_cell</span><span class="p">(</span><span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="n">a</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<p>We now assert it needs to be calculated and calculate it…</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">c</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">go</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">c</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="mi">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="ow">not</span> <span class="n">c</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>Now let us cheat and tell it, it was last run 3 days ago…</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">c</span><span class="o">.</span><span class="n">updated</span> <span class="o">=</span> <span class="n">dt</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">c</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="pyg.mongo._periodic_cell.periodic_cell.run">
<span class="sig-name descname"><span class="pre">run</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#pyg.mongo._periodic_cell.periodic_cell.run" title="Permalink to this definition">¶</a></dt>
<dd><p>checks if the cell needs calculation. This depends on the nature of the cell. 
By default (for cell and db_cell), if the cell is already calculated so that cell._output exists, then returns False. otherwise True</p>
<dl class="simple">
<dt>bool</dt><dd><p>run cell?</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Example</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">cell</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">c</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">c</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">c</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">c</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

</section>
<section id="get-cell">
<h3>get_cell<a class="headerlink" href="#get-cell" title="Permalink to this headline">¶</a></h3>
</section>
<section id="db-save">
<h3>db_save<a class="headerlink" href="#db-save" title="Permalink to this headline">¶</a></h3>
<dl class="py function">
<dt class="sig sig-object py" id="pyg.mongo._db_cell.db_save">
<span class="sig-prename descclassname"><span class="pre">pyg.mongo._db_cell.</span></span><span class="sig-name descname"><span class="pre">db_save</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">value</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyg.mongo._db_cell.db_save" title="Permalink to this definition">¶</a></dt>
<dd><p>saves a db_cell from the database. Will iterates through lists and dicts</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<dl class="simple">
<dt>value: obj</dt><dd><p>db_cell (or list/dict of) to be loaded</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Example</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyg</span> <span class="kn">import</span> <span class="o">*</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">mongo_table</span><span class="p">,</span> <span class="n">table</span> <span class="o">=</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="n">db</span> <span class="o">=</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="n">pk</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">db_cell</span><span class="p">(</span><span class="n">add_</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="n">db</span> <span class="o">=</span> <span class="n">db</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">db_save</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>    
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">get_cell</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;test&#39;</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="db-load">
<h3>db_load<a class="headerlink" href="#db-load" title="Permalink to this headline">¶</a></h3>
<dl class="py function">
<dt class="sig sig-object py" id="pyg.mongo._db_cell.db_load">
<span class="sig-prename descclassname"><span class="pre">pyg.mongo._db_cell.</span></span><span class="sig-name descname"><span class="pre">db_load</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">value</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mode</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyg.mongo._db_cell.db_load" title="Permalink to this definition">¶</a></dt>
<dd><p>loads a db_cell from the database. Iterates through lists and dicts</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<dl class="simple">
<dt>value: obj</dt><dd><p>db_cell (or list/dict of) to be loaded</p>
</dd>
<dt>mode: int</dt><dd><p>loading mode -1: dont load, +1: load and throw an exception if not found, 0: load if found</p>
</dd>
</dl>
</dd></dl>

</section>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">pyg</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="includeme.html">README</a></li>
<li class="toctree-l1"><a class="reference internal" href="base.html">pyg.base</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">pyg.mongo</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#query-generator">Query generator</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#q-and-q">q and Q</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#tables-in-mongo">Tables in Mongo</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#mongo-cursor">mongo_cursor</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mongo-reader">mongo_reader</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mongo-pk-reader">mongo_pk_reader</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mongo-pk-cursor">mongo_pk_cursor</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#encoding-docs-before-saving-to-mongo">encoding docs before saving to mongo</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#parquet-write">parquet_write</a></li>
<li class="toctree-l3"><a class="reference internal" href="#csv-write">csv_write</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#cells-in-mongo">cells in Mongo</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#db-cell">db_cell</a></li>
<li class="toctree-l3"><a class="reference internal" href="#periodic-cell">periodic_cell</a></li>
<li class="toctree-l3"><a class="reference internal" href="#get-cell">get_cell</a></li>
<li class="toctree-l3"><a class="reference internal" href="#db-save">db_save</a></li>
<li class="toctree-l3"><a class="reference internal" href="#db-load">db_load</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="timeseries.html">pyg.timeseries</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab/tutorial_dict.html">pyg.base.Dict</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab/tutorial_dictable.html">pyg.base.dictable</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab/tutorial_mongo.html">pyg.mongo</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab/tutorial_cell.html">pyg.base.cell</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab/tutorial_perdictable.html">pyg.base.join</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab/tutorial_timeseries.html">pyg.timeseries</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab/tutorial_ts_decorators.html">pyg.timeseries decorators</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab/tutorial_ts_ewma_time.html">pyg.timeseries.ewma</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="base.html" title="previous chapter">pyg.base</a></li>
      <li>Next: <a href="timeseries.html" title="next chapter">pyg.timeseries</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2021, Yoav Git.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.2.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/mongo.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>